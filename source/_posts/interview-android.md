---
title: Android é¢è¯•ï¼šAndroid ç®€è¿°é¢˜
date: 2016-10-26 11:06:15
categories:
- Android é¢è¯•
tags:
- Android é¢è¯•
---

æœ¬æ–‡æ”¶é›†æ•´ç†äº† Android é¢è¯•ä¸­ä¼šé‡åˆ°ä¸ Android çŸ¥è¯†ç›¸å…³çš„ç®€è¿°é¢˜ã€‚<!--more-->

## Android çš„å››å¤§ç»„ä»¶





## ä»‹ç»Activityã€Serviceã€Broadcastã€BroadcastReceiverã€Intentã€IntentFilter

Activity :

åº”ç”¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªActivityé€šå¸¸å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„å±å¹•ï¼Œå®ƒä¸Šé¢å¯ä»¥æ˜¾ç¤ºä¸€äº›æ§ä»¶ä¹Ÿå¯ä»¥ç›‘å¬å¹¶å¤„ç†ç”¨æˆ·çš„äº‹ä»¶åšå‡ºå“åº”ã€‚

BroadcastReceiverå¹¿æ’­æ¥æ”¶å™¨:

åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨å®ƒå¯¹å¤–éƒ¨äº‹ä»¶è¿›è¡Œè¿‡æ»¤åªå¯¹æ„Ÿå…´è¶£çš„å¤–éƒ¨äº‹ä»¶(å¦‚å½“ç”µè¯å‘¼å…¥æ—¶ï¼Œæˆ–è€…æ•°æ®ç½‘ç»œå¯ç”¨æ—¶)è¿›è¡Œæ¥æ”¶å¹¶åšå‡ºå“åº”ã€‚å¹¿æ’­æ¥æ”¶å™¨æ²¡æœ‰ç”¨æˆ·ç•Œé¢ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¯ä»¥å¯åŠ¨ä¸€ä¸ªactivityæˆ–serice æ¥å“åº”å®ƒä»¬æ”¶åˆ°çš„ä¿¡æ¯ï¼Œæˆ–è€…ç”¨NotificationManager æ¥é€šçŸ¥ç”¨æˆ·ã€‚é€šçŸ¥å¯ä»¥ç”¨å¾ˆå¤šç§æ–¹å¼æ¥å¸å¼•ç”¨æˆ·çš„æ³¨æ„åŠ›â”€â”€é—ªåŠ¨èƒŒç¯ã€éœ‡åŠ¨ã€æ’­æ”¾å£°éŸ³ç­‰ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯åœ¨çŠ¶æ€æ ä¸Šæ”¾ä¸€ä¸ªæŒä¹…çš„å›¾æ ‡ï¼Œç”¨æˆ·å¯ä»¥æ‰“å¼€å®ƒå¹¶è·å–æ¶ˆæ¯ã€‚

Service æœåŠ¡:

ä¸€ä¸ªService æ˜¯ä¸€æ®µé•¿ç”Ÿå‘½å‘¨æœŸçš„ï¼Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„ç¨‹åºï¼Œå¯ä»¥ç”¨æ¥å¼€å‘å¦‚ç›‘æ§ç±»ç¨‹åºã€‚

Content Providerå†…å®¹æä¾›è€… :

androidå¹³å°æä¾›äº†Content Providerä½¿ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„æŒ‡å®šæ•°æ®é›†æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºã€‚è¿™äº›æ•°æ®å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ã€åœ¨ä¸€ä¸ªSQLiteæ•°æ®åº“ã€æˆ–ä»¥ä»»ä½•å…¶ä»–åˆç†çš„æ–¹å¼ã€‚å…¶ä»–åº”ç”¨å¯ä»¥é€šè¿‡ContentResolverç±»(è§ContentProviderAccessAppä¾‹å­)ä»è¯¥å†…å®¹æä¾›è€…ä¸­è·å–æˆ–å­˜å…¥æ•°æ®.(ç›¸å½“äºåœ¨åº”ç”¨å¤–åŒ…äº†ä¸€å±‚å£³),åªæœ‰éœ€è¦åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºé—´å…±äº«æ•°æ®æ˜¯æ‰éœ€è¦å†…å®¹æä¾›è€…ã€‚ä¾‹å¦‚ï¼Œé€šè®¯å½•æ•°æ®è¢«å¤šä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä¸”å¿…é¡»å­˜å‚¨åœ¨ä¸€ä¸ªå†…å®¹æä¾›è€…ä¸­ã€‚

å®ƒçš„å¥½å¤„:ç»Ÿä¸€æ•°æ®è®¿é—®æ–¹å¼ã€‚

# Activity

## Activity ç”Ÿå‘½å‘¨æœŸ

- å¯åŠ¨Activityï¼šonCreate->onStart->onResume
- é”å±æˆ–è¢«å…¶å®ƒActivityè¦†ç›–ï¼šonPause->onStop
- è§£é”æˆ–ç”±è¢«è¦†ç›–çŠ¶æ€å†å›åˆ°å‰å°ï¼šonRestart->onStart->onResume
- è·³è½¬åˆ°å…¶å®ƒActivityæˆ–æŒ‰Homeè¿›å…¥åå°ï¼šonPause->onStop
- é€€å›åˆ°æ­¤Activityï¼šonRestart->onStart->onResume
- é€€å‡ºæ­¤Activityï¼šonPause->onStop->onDestory
- å¯¹è¯æ¡†å¼¹å‡ºä¸ä¼šæ‰§è¡Œä»»ä½•ç”Ÿå‘½å‘¨æœŸ(æ³¨ï¼šå¯¹è¯æ¡†å¦‚æœæ˜¯Activity(Themeä¸ºDialog)ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œç”Ÿå‘½å‘¨æœŸçš„)
- â€‹
- ä»Aè·³è½¬åˆ°Bï¼šå½“Bçš„ä¸»é¢˜ä¸ºé€æ˜æ—¶ï¼ŒAåªä¼šæ‰§è¡ŒonPauseï¼ˆA-onPause->B-(onCreate->onStart->onResume)ï¼‰
- ä»Aè·³è½¬åˆ°Bï¼šA-onPause->B-(onCreate->onStart->onResume)-A-onStop(æ³¨æ„æ˜¯Aæ‰§è¡ŒonPauseåå¼€å§‹æ‰§è¡ŒBçš„ç”Ÿå‘½å‘¨æœŸï¼ŒBæ‰§è¡ŒonResumeåï¼ŒAæ‰æ‰§è¡ŒonStopï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨onPauseä¸­åšè€—æ—¶æ“ä½œ)
- ä»Bè¿”å›åˆ°Aï¼šB-onPause->A-(onRestart->onStart->onResume)-B-(onStop->onDestroy)

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-25/30416013.jpg)

## Activityå’ŒFragmentç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿ

```java
Activityâ€”â€”onCreate->onStart->onResume->onPause->onStop->onDestroy

Fragmentâ€”â€”onAttach->onCreate->onCreateView->onActivityCreated->onStart->onResume->onPause->onStop->onDestroyView->onDestroy->onDetach
```

## LanchMode çš„åº”ç”¨åœºæ™¯

- standard æ¨¡å¼

è¿™æ˜¯é»˜è®¤æ¨¡å¼ï¼Œæ¯æ¬¡æ¿€æ´»Activityæ—¶éƒ½ä¼šåˆ›å»ºActivityå®ä¾‹ï¼Œå¹¶æ”¾å…¥ä»»åŠ¡æ ˆä¸­ã€‚

- singleTop æ¨¡å¼

å¦‚æœåœ¨ä»»åŠ¡çš„æ ˆé¡¶æ­£å¥½å­˜åœ¨è¯¥Activityçš„å®ä¾‹ï¼Œå°±é‡ç”¨è¯¥å®ä¾‹( ä¼šè°ƒç”¨å®ä¾‹çš„ onNewIntent() )ï¼Œå¦åˆ™å°±ä¼šåˆ›å»ºæ–°çš„å®ä¾‹å¹¶æ”¾å…¥æ ˆé¡¶ï¼Œå³ä½¿æ ˆä¸­å·²ç»å­˜åœ¨è¯¥Activityçš„å®ä¾‹ï¼Œåªè¦ä¸åœ¨æ ˆé¡¶ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ã€‚

- singleTask æ¨¡å¼

å¦‚æœåœ¨æ ˆä¸­å·²ç»æœ‰è¯¥Activityçš„å®ä¾‹ï¼Œå°±é‡ç”¨è¯¥å®ä¾‹(ä¼šè°ƒç”¨å®ä¾‹çš„ onNewIntent() )ã€‚é‡ç”¨æ—¶ï¼Œä¼šè®©è¯¥å®ä¾‹å›åˆ°æ ˆé¡¶ï¼Œå› æ­¤åœ¨å®ƒä¸Šé¢çš„å®ä¾‹å°†ä¼šè¢«ç§»å‡ºæ ˆã€‚å¦‚æœæ ˆä¸­ä¸å­˜åœ¨è¯¥å®ä¾‹ï¼Œå°†ä¼šåˆ›å»ºæ–°çš„å®ä¾‹æ”¾å…¥æ ˆä¸­ã€‚

- singleInstance æ¨¡å¼

åœ¨ä¸€ä¸ªæ–°æ ˆä¸­åˆ›å»ºè¯¥Activityçš„å®ä¾‹ï¼Œå¹¶è®©å¤šä¸ªåº”ç”¨å…±äº«è¯¥æ ˆä¸­çš„è¯¥Activityå®ä¾‹ã€‚ä¸€æ—¦è¯¥æ¨¡å¼çš„Activityå®ä¾‹å·²ç»å­˜åœ¨äºæŸä¸ªæ ˆä¸­ï¼Œä»»ä½•åº”ç”¨å†æ¿€æ´»è¯¥Activityæ—¶éƒ½ä¼šé‡ç”¨è¯¥æ ˆä¸­çš„å®ä¾‹( ä¼šè°ƒç”¨å®ä¾‹çš„ onNewIntent() )ã€‚å…¶æ•ˆæœç›¸å½“äºå¤šä¸ªåº”ç”¨å…±äº«ä¸€ä¸ªåº”ç”¨ï¼Œä¸ç®¡è°æ¿€æ´»è¯¥ Activity éƒ½ä¼šè¿›å…¥åŒä¸€ä¸ªåº”ç”¨ä¸­ã€‚

è®¾ç½®å¯åŠ¨æ¨¡å¼çš„ä½ç½®åœ¨ AndroidManifest.xml æ–‡ä»¶ä¸­ Activity å…ƒç´ çš„ Android:launchMode å±æ€§ã€‚

singleTopé€‚åˆæ¥æ”¶é€šçŸ¥å¯åŠ¨çš„å†…å®¹æ˜¾ç¤ºé¡µé¢ã€‚

ä¾‹å¦‚ï¼ŒæŸä¸ªæ–°é—»å®¢æˆ·ç«¯çš„æ–°é—»å†…å®¹é¡µé¢ï¼Œå¦‚æœæ”¶åˆ°10ä¸ªæ–°é—»æ¨é€ï¼Œæ¯æ¬¡éƒ½æ‰“å¼€ä¸€ä¸ªæ–°é—»å†…å®¹é¡µé¢æ˜¯å¾ˆçƒ¦äººçš„ã€‚

singleTaské€‚åˆä½œä¸ºç¨‹åºå…¥å£ç‚¹ã€‚

ä¾‹å¦‚æµè§ˆå™¨çš„ä¸»ç•Œé¢ã€‚ä¸ç®¡ä»å¤šå°‘ä¸ªåº”ç”¨å¯åŠ¨æµè§ˆå™¨ï¼Œåªä¼šå¯åŠ¨ä¸»ç•Œé¢ä¸€æ¬¡ï¼Œå…¶ä½™æƒ…å†µéƒ½ä¼šèµ°onNewIntentï¼Œå¹¶ä¸”ä¼šæ¸…ç©ºä¸»ç•Œé¢ä¸Šé¢çš„å…¶ä»–é¡µé¢ã€‚

singleInstanceåº”ç”¨åœºæ™¯ï¼š

é—¹é“ƒçš„å“é“ƒç•Œé¢ã€‚ ä½ ä»¥å‰è®¾ç½®äº†ä¸€ä¸ªé—¹é“ƒï¼šä¸Šåˆ6ç‚¹ã€‚åœ¨ä¸Šåˆ5ç‚¹58åˆ†ï¼Œä½ å¯åŠ¨äº†é—¹é“ƒè®¾ç½®ç•Œé¢ï¼Œå¹¶æŒ‰ Home é”®å›æ¡Œé¢ï¼›åœ¨ä¸Šåˆ5ç‚¹59åˆ†æ—¶ï¼Œä½ åœ¨å¾®ä¿¡å’Œæœ‹å‹èŠå¤©ï¼›åœ¨6ç‚¹æ—¶ï¼Œé—¹é“ƒå“äº†ï¼Œå¹¶ä¸”å¼¹å‡ºäº†ä¸€ä¸ªå¯¹è¯æ¡†å½¢å¼çš„ Activity(åä¸º AlarmAlertActivity) æç¤ºä½ åˆ°6ç‚¹äº†(è¿™ä¸ª Activity å°±æ˜¯ä»¥ SingleInstance åŠ è½½æ¨¡å¼æ‰“å¼€çš„)ï¼Œä½ æŒ‰è¿”å›é”®ï¼Œå›åˆ°çš„æ˜¯å¾®ä¿¡çš„èŠå¤©ç•Œé¢ï¼Œè¿™æ˜¯å› ä¸º AlarmAlertActivity æ‰€åœ¨çš„ Task çš„æ ˆåªæœ‰ä»–ä¸€ä¸ªå…ƒç´ ï¼Œ å› æ­¤é€€å‡ºä¹‹åè¿™ä¸ª Task çš„æ ˆç©ºäº†ã€‚å¦‚æœæ˜¯ä»¥ SingleTask æ‰“å¼€ AlarmAlertActivityï¼Œé‚£ä¹ˆå½“é—¹é“ƒå“äº†çš„æ—¶å€™ï¼ŒæŒ‰è¿”å›é”®åº”è¯¥è¿›å…¥é—¹é“ƒè®¾ç½®ç•Œé¢ã€‚

## Activityä¸­ç±»ä¼¼onCreateã€onStartè¿ç”¨äº†å“ªç§è®¾è®¡æ¨¡å¼ï¼Œä¼˜ç‚¹æ˜¯ä»€ä¹ˆ

æ¨¡æ¿æ¨¡å¼ã€‚æ¯æ¬¡æ–°å»ºä¸€ä¸ªActiivtyæ—¶éƒ½ä¼šè¦†ç›–onCreateï¼ŒonStartç­‰æ–¹æ³•,è¿™äº›æ–¹æ³•åœ¨çˆ¶ç±»ä¸­å°±ç›¸å½“äºä¸€ä¸ªæ¨¡æ¿

## å¦‚ä½•å°†ä¸€ä¸ªActivityè®¾ç½®æˆçª—å£çš„æ ·å¼

- åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è®¾ç½®å½“å‰éœ€è¦æ”¹å˜æˆçª—å£æ ·å¼çš„Activityçš„å±æ€§ï¼Œå³

```
android:theme="@android:style/Theme.Dialog"  
```

- åœ¨styles.xmlæ–‡ä»¶ä¸­è‡ªå®šä¹‰ä¸€ä¸ªä¸»é¢˜æ ·å¼ï¼Œæ”¹ä¸»é¢˜æ ·å¼å¿…é¡»ç»§æ‰¿Dialogçš„æ ·å¼.

## Activityçš„å¯åŠ¨è¿‡ç¨‹

1. æ— è®ºæ˜¯é€šè¿‡Launcheræ¥å¯åŠ¨Activityï¼Œè¿˜æ˜¯é€šè¿‡Activityå†…éƒ¨è°ƒç”¨startActivityæ¥å£æ¥å¯åŠ¨æ–°çš„Activityï¼Œéƒ½é€šè¿‡Binderè¿›ç¨‹é—´é€šä¿¡è¿›å…¥åˆ°ActivityManagerServiceè¿›ç¨‹ä¸­ï¼Œå¹¶ä¸”è°ƒç”¨ActivityManagerService.startActivityæ¥å£ï¼› 
2. ActivityManagerServiceè°ƒç”¨ActivityStack.startActivityMayWaitæ¥åšå‡†å¤‡è¦å¯åŠ¨çš„Activityçš„ç›¸å…³ä¿¡æ¯ï¼›
3. ActivityStacké€šçŸ¥ApplicationThreadè¦è¿›è¡ŒActivityå¯åŠ¨è°ƒåº¦äº†ï¼Œè¿™é‡Œçš„ApplicationThreadä»£è¡¨çš„æ˜¯è°ƒç”¨ActivityManagerService.startActivityæ¥å£çš„è¿›ç¨‹ï¼Œå¯¹äºé€šè¿‡ç‚¹å‡»åº”ç”¨ç¨‹åºå›¾æ ‡çš„æƒ…æ™¯æ¥è¯´ï¼Œè¿™ä¸ªè¿›ç¨‹å°±æ˜¯Launcheräº†ï¼Œè€Œå¯¹äºé€šè¿‡åœ¨Activityå†…éƒ¨è°ƒç”¨startActivityçš„æƒ…æ™¯æ¥è¯´ï¼Œè¿™ä¸ªè¿›ç¨‹å°±æ˜¯è¿™ä¸ªActivityæ‰€åœ¨çš„è¿›ç¨‹äº†ï¼›
4. ApplicationThreadä¸æ‰§è¡ŒçœŸæ­£çš„å¯åŠ¨æ“ä½œï¼Œå®ƒé€šè¿‡è°ƒç”¨ActivityManagerService.activityPausedæ¥å£è¿›å…¥åˆ°ActivityManagerServiceè¿›ç¨‹ä¸­ï¼Œçœ‹çœ‹æ˜¯å¦éœ€è¦åˆ›å»ºæ–°çš„è¿›ç¨‹æ¥å¯åŠ¨Activityï¼›
5. å¯¹äºé€šè¿‡ç‚¹å‡»åº”ç”¨ç¨‹åºå›¾æ ‡æ¥å¯åŠ¨Activityçš„æƒ…æ™¯æ¥è¯´ï¼ŒActivityManagerServiceåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œä¼šè°ƒç”¨startProcessLockedæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œè€Œå¯¹äºé€šè¿‡åœ¨Activityå†…éƒ¨è°ƒç”¨startActivityæ¥å¯åŠ¨æ–°çš„Activityæ¥è¯´ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸éœ€è¦æ‰§è¡Œçš„ï¼Œå› ä¸ºæ–°çš„Activityå°±åœ¨åŸæ¥çš„Activityæ‰€åœ¨çš„è¿›ç¨‹ä¸­è¿›è¡Œå¯åŠ¨ï¼›
6. ActivityManagerServicè°ƒç”¨ApplicationThread.scheduleLaunchActivityæ¥å£ï¼Œé€šçŸ¥ç›¸åº”çš„è¿›ç¨‹æ‰§è¡Œå¯åŠ¨Activityçš„æ“ä½œï¼›
7. ApplicationThreadæŠŠè¿™ä¸ªå¯åŠ¨Activityçš„æ“ä½œè½¬å‘ç»™ActivityThreadï¼ŒActivityThreadé€šè¿‡ClassLoaderå¯¼å…¥ç›¸åº”çš„Activityç±»ï¼Œç„¶åæŠŠå®ƒå¯åŠ¨èµ·æ¥ã€‚



## windowså’Œactivityä¹‹é—´å…³ç³»ï¼Ÿ

## WindowManager çš„ç›¸å…³çŸ¥è¯†

## Activityã€Window å’Œ View ä¸‰è€…çš„åŒºåˆ«

- ä¸€ä¸ª Activity æ„é€ çš„æ—¶å€™ä¸€å®šä¼šæ„é€ ä¸€ä¸ª Window(PhoneWindow)ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ª
- è¿™ä¸ªWindowä¼šæœ‰ä¸€ä¸ªViewRoot(Viewã€ViewGroup)
- é€šè¿‡addView()åŠ è½½å¸ƒå±€
- WindowMangerService æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶ä¸”å›åˆ° Activity å‡½æ•°ï¼Œæ¯”å¦‚onKeyDown()

Activity æ˜¯æ§åˆ¶å•å…ƒï¼ŒWindow æ˜¯æ‰¿è½½æ¨¡å‹ï¼ŒView æ˜¯æ˜¾ç¤ºè§†å›¾

## ä¸€ä¸ªactivityæ‰“å¼€å¦å¤–ä¸€ä¸ªactivityï¼Œå†æ‰“å¼€ä¸€ä¸ªactivityï¼Ÿå›å»çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆæ“ä½œï¼Ÿ



## onActivityResult(int requestCode, int resultCode, Intent data)æ–¹æ³•çš„ç”¨æ³•ï¼›

å¦‚æœä½ æƒ³åœ¨Activityä¸­å¾—åˆ°æ–°æ‰“å¼€Activityå…³é—­åè¿”å›çš„æ•°æ®ï¼Œä½ éœ€è¦ä½¿ç”¨ç³»ç»Ÿæä¾›çš„startActivityForResult(Intent intent,int requestCode)æ–¹æ³•æ‰“å¼€æ–°çš„Activityï¼Œæ–°çš„Activityå…³é—­åä¼šå‘å‰é¢çš„Activityä¼ å›æ•°æ®ï¼Œä¸ºäº†å¾—åˆ°ä¼ å›çš„æ•°æ®ï¼Œä½ å¿…é¡»åœ¨å‰é¢çš„Activityä¸­é‡å†™onActivityResult(int requestCode, int resultCode,Intent data)æ–¹æ³•ã€‚

## ä¸ç”¨Service,Bé¡µé¢ä¸ºéŸ³ä¹æ’­æ”¾ï¼Œä»Aè·³åˆ°Bï¼Œå†è¿”å›ï¼Œå¦‚ä½•ä½¿éŸ³ä¹ç»§ç»­æ’­æ”¾ï¼Ÿ

Aä½¿ç”¨startActivityForResultæ–¹æ³•å¼€å¯Bï¼ŒBç±»ç»“æŸæ—¶è°ƒç”¨finish;Aç±»çš„Intentæœ‰ä¸€ä¸ªå­Activityç»“æŸäº‹ä»¶onActivityResultï¼Œåœ¨è¿™ä¸ªäº‹ä»¶é‡Œç»§ç»­æ’­æ”¾éŸ³ä¹ã€‚

## å†…å­˜ä¸è¶³æ—¶ï¼Œæ€ä¹ˆä¿æŒActivityçš„ä¸€äº›çŠ¶æ€ï¼Œåœ¨å“ªä¸ªæ–¹æ³•é‡Œé¢åšå…·ä½“æ“ä½œï¼Ÿ

åœ¨onSaveInstanceStateæ–¹æ³•ä¸­ä¿å­˜Activityçš„çŠ¶æ€ï¼Œåœ¨onRestoreInstanceStateæˆ–onCreateæ–¹æ³•ä¸­æ¢å¤Activityçš„çŠ¶æ€

## onSaveInstanceStateæ–¹æ³•

- ç”¨äºä¿å­˜Activityçš„çŠ¶æ€å­˜å‚¨ä¸€äº›ä¸´æ—¶æ•°æ®
- Activityè¢«è¦†ç›–æˆ–è¿›å…¥åå°ï¼Œç”±äºç³»ç»Ÿèµ„æºä¸è¶³è¢«killä¼šè¢«è°ƒç”¨
- ç”¨æˆ·æ”¹å˜å±å¹•æ–¹å‘ä¼šè¢«è°ƒç”¨
- è·³è½¬åˆ°å…¶å®ƒActivityæˆ–æŒ‰Homeè¿›å…¥åå°ä¼šè¢«è°ƒç”¨
- ä¼šåœ¨onStopä¹‹å‰è¢«è°ƒç”¨ï¼Œå’ŒonPauseçš„é¡ºåºä¸å›ºå®šçš„

## onRestoreInstanceState(Bundle savedInstanceState)æ–¹æ³•

- ç”¨äºæ¢å¤ä¿å­˜çš„ä¸´æ—¶æ•°æ®ï¼Œæ­¤æ–¹æ³•çš„Bundleå‚æ•°ä¹Ÿä¼šä¼ é€’åˆ°onCreateæ–¹æ³•ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨onCreate(Bundle savedInstanceState)æ–¹æ³•ä¸­æ¢å¤æ•°æ®
- onRestoreInstanceStateå’ŒonCreateçš„åŒºåˆ«ï¼šå½“onRestoreInstanceStateè¢«è°ƒç”¨æ—¶Bundleå‚æ•°ä¸€å®šæ˜¯æœ‰å€¼çš„ï¼Œä¸ç”¨åšä¸ºnullåˆ¤æ–­ï¼ŒonCreateçš„Bundleåˆ™å¯èƒ½ä¼šä¸ºnullã€‚å®˜æ–¹æ–‡æ¡£å»ºè®®åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡Œæ•°æ®æ¢å¤ã€‚
- ç”±äºç³»ç»Ÿèµ„æºä¸è¶³è¢«killä¹‹ååˆå›åˆ°æ­¤Activityä¼šè¢«è°ƒç”¨
- ç”¨æˆ·æ”¹å˜å±å¹•æ–¹å‘é‡å»ºActivityæ—¶ä¼šè¢«è°ƒç”¨
- ä¼šåœ¨onStartä¹‹åè¢«è°ƒç”¨

## åŒä¸€ä¸ªç¨‹åºä¸åŒçš„Activityå¦‚ä½•æ”¾åœ¨ä¸åŒçš„ä»»åŠ¡æ ˆä¸­ï¼Ÿ

éœ€è¦ä¸ºä¸åŒçš„activityè®¾ç½®ä¸åŒçš„affinityå±æ€§ï¼Œå¯åŠ¨activityçš„Intentéœ€è¦åŒ…å«FLAG_ACTIVITY_NEW_TASKæ ‡è®°ã€‚

## å¦‚ä½•å®‰å…¨é€€å‡ºå·²è°ƒç”¨å¤šä¸ªActivityçš„Applicationï¼Ÿ

-è®°å½•æ‰“å¼€çš„Activityï¼šæ¯æ‰“å¼€ä¸€ä¸ªActivityï¼Œå°±è®°å½•ä¸‹æ¥ã€‚åœ¨éœ€è¦é€€å‡ºæ—¶ï¼Œå…³é—­æ¯ä¸€ä¸ªActivityå³å¯ã€‚
-å‘é€ç‰¹å®šå¹¿æ’­ï¼šåœ¨éœ€è¦ç»“æŸåº”ç”¨æ—¶ï¼Œå‘é€ä¸€ä¸ªç‰¹å®šçš„å¹¿æ’­ï¼Œæ¯ä¸ªActivityæ”¶åˆ°å¹¿æ’­åï¼Œå…³é—­å³å¯ã€‚
-é€’å½’é€€å‡ºï¼šåœ¨æ‰“å¼€æ–°çš„Activityæ—¶ä½¿ç”¨startActivityForResultï¼Œç„¶åè‡ªå·±åŠ æ ‡å¿—ï¼Œåœ¨onActivityResultä¸­å¤„ç†ï¼Œé€’å½’å…³é—­ã€‚



# Fragment

## Fragmentç”Ÿå‘½å‘¨æœŸ

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-19/72771704.jpg)



## Activityä¸­å¦‚ä½•åŠ¨æ€çš„æ·»åŠ Fragmentï¼Ÿ

```java
//å‘æ´»åŠ¨æ·»åŠ ç¢ç‰‡,æ ¹æ®å±å¹•çš„çºµå‘å’Œæ¨ªå‘æ˜¾ç¤º
//1,è·å–ç¢ç‰‡ç®¡ç†å™¨
FragmentManager fragment=getFragmentManager();
//2,ç¢ç‰‡çš„æ˜¾ç¤ºéœ€è¦ä½¿ç”¨FragmentTransactionç±»æ“ä½œ
FragmentTransaction transacction=fragment.beginTransaction();
//è·å–å±å¹•ç®¡ç†å™¨å’Œé»˜è®¤çš„æ˜¾ç¤º
Display display=getWindowManager().getDefaultDisplay();
//åˆ¤æ–­æ¨ªå±
if(display.getWidth()>display.getHeight()){
	//è·å–javaç±»
	Frament1 frament1 =  new Frament1();
	transacction.replace(android.R.id.content, frament1);
}else{
	Frament2 frament2 =  new Frament2();
	transacction.replace(android.R.id.content, frament2);
}
//ä½¿ç”¨FragmentTransactionå¿…é¡»è¦commit
transacction.commit();
```

## Fragment ç‰¹ç‚¹

-Fragmentå¯ä»¥ä½œä¸ºActivityç•Œé¢çš„ä¸€éƒ¨åˆ†ç»„æˆå‡ºç°ï¼›
-å¯ä»¥åœ¨ä¸€ä¸ªActivityä¸­åŒæ—¶å‡ºç°å¤šä¸ªFragmentï¼Œå¹¶ä¸”ä¸€ä¸ªFragmentä¹Ÿå¯ä»¥åœ¨å¤šä¸ªActivityä¸­ä½¿ç”¨ï¼›
-åœ¨Activityè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ·»åŠ ã€ç§»é™¤æˆ–è€…æ›¿æ¢Fragmentï¼›
-Fragmentå¯ä»¥å“åº”è‡ªå·±çš„è¾“å…¥äº‹ä»¶ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¼šå—å®¿ä¸»Activityçš„ç”Ÿå‘½å‘¨æœŸå½±å“ã€‚
-Fragmentå¯ä»¥è½»æ¾å¾—åˆ›å»ºåŠ¨æ€çµæ´»çš„UIè®¾è®¡ï¼Œå¯ä»¥é€‚åº”äºä¸åŒçš„å±å¹•å°ºå¯¸ã€‚ä»æ‰‹æœºåˆ°å¹³æ¿ç”µè„‘ã€‚
-Fragment è§£å†³Activityé—´çš„åˆ‡æ¢ä¸æµç•…ï¼Œè½»é‡åˆ‡æ¢ã€‚
-Fragment æ›¿ä»£TabActivityåšå¯¼èˆªï¼Œæ€§èƒ½æ›´å¥½ã€‚
-Fragmentåšå±€éƒ¨å†…å®¹æ›´æ–°æ›´æ–¹ä¾¿ï¼ŒåŸæ¥ä¸ºäº†åˆ°è¾¾è¿™ä¸€ç‚¹è¦æŠŠå¤šä¸ªå¸ƒå±€æ”¾åˆ°ä¸€ä¸ªactivityé‡Œé¢ï¼Œç°åœ¨å¯ä»¥ç”¨å¤šFragmentæ¥ä»£æ›¿ï¼Œåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ è½½Fragmentï¼Œæé«˜æ€§èƒ½ã€‚

## FragmentåµŒå¥—å¤šä¸ªFragmentä¼šå‡ºç°bugå—ï¼Ÿ

å‚è€ƒï¼šhttp://blog.csdn.net/megatronkings/article/details/51417510

# Service

## ä»€ä¹ˆæ˜¯Serviceä»¥åŠæè¿°ä¸‹å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚

Serviceæ˜¯è¿è¡Œåœ¨åå°çš„androidç»„ä»¶ï¼Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢ï¼Œä¸èƒ½ä¸ç”¨æˆ·äº¤äº’ï¼Œå¯ä»¥è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨å…¶ä»–åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹
æ–‡é‡Œã€‚

Serviceéšç€å¯åŠ¨å½¢å¼çš„ä¸åŒï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç¨æœ‰å·®åˆ«ã€‚å½“ç”¨Context.startService()æ¥å¯åŠ¨æ—¶ï¼ŒServiceçš„ç”Ÿå‘½å‘¨æœŸä¾æ¬¡ä¸º:oncreateâ€”â€”>onStartCommandâ€”â€”>onDestroy 

å½“ç”¨Context.bindService()å¯åŠ¨æ—¶:onStartâ€”â€”>onBindâ€”â€”>onUnbindâ€”â€”>onDestroy

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-25/20789048.jpg)

## Serviceæœ‰å“ªäº›å¯åŠ¨æ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ€æ ·åœç”¨Serviceï¼Ÿ

Serviceå¯åŠ¨æ–¹å¼æœ‰ä¸¤ç§ï¼›ä¸€æ˜¯Context.startServiceå’ŒContext.bindServiceã€‚
   åŒºåˆ«æ˜¯é€šè¿‡startServiceå¯åŠ¨æ—¶Serviceç»„ä»¶å’Œåº”ç”¨ç¨‹åºæ²¡å¤šå¤§çš„è”ç³»ï¼›å½“ç”¨è®¿é—®è€…å¯åŠ¨ä¹‹åï¼Œå¦‚æœè®¿é—®è€…ä¸ä¸»åŠ¨å…³é—­ï¼ŒServiceå°±ä¸ä¼šå…³é—­ï¼ŒServiceç»„ä»¶ä¹‹é—´
å› ä¸ºæ²¡ä»€ä¹ˆå…³è”ï¼Œæ‰€ä»¥Serviceä¹Ÿä¸èƒ½å’Œåº”ç”¨ç¨‹åºè¿›è¡Œæ•°æ®äº¤äº’ã€‚è€Œé€šè¿‡bindServiceè¿›è¡Œç»‘å®šæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ServiceConnectionè¿›è¡Œæ•°æ®äº¤äº’ã€‚åœ¨å®ç°Service
æ—¶é‡å†™çš„onBindæ–¹æ³•ä¸­ï¼Œå…¶è¿”å›çš„å¯¹è±¡ä¼šä¼ ç»™ServiceConnectionå¯¹è±¡çš„onServiceConnected(ComponentName name, IBinder service)ä¸­çš„serviceå‚æ•°ï¼›ä¹Ÿå°±æ˜¯è¯´è·å–
äº†serivceè¿™ä¸ªå‚æ•°å°±å¾—åˆ°äº†Serivceç»„ä»¶è¿”å›çš„å€¼ã€‚Context.bindService(Intent intent,ServiceConnection conn,int flag)å…¶ä¸­åªè¦ä¸Serviceè¿æ¥æˆåŠŸ
connå°±ä¼šè°ƒç”¨å…¶onServiceConnectedæ–¹æ³•

   åœç”¨Serviceä½¿ç”¨Context.stopService

## æ³¨å†ŒServiceéœ€è¦æ³¨æ„ä»€ä¹ˆ

æ— è®ºä½¿ç”¨å“ªç§å¯åŠ¨æ–¹æ³•ï¼Œéƒ½éœ€è¦åœ¨xmlé‡Œæ³¨å†Œä½ çš„Serviceï¼Œå°±åƒè¿™æ ·:

```
<service
        android:name=".packnameName.youServiceName"
        android:enabled="true" />
```

## service å¯ä»¥æ‰§è¡Œè€—æ—¶æ“ä½œå—

ä¸èƒ½

## Serviceå’ŒActivityåœ¨åŒä¸€ä¸ªçº¿ç¨‹å—

é»˜è®¤æƒ…å†µä¸‹æ˜¯åœ¨åŒä¸€ä¸ªä¸»çº¿ç¨‹ä¸­ã€‚ä½†å¯ä»¥é€šè¿‡é…ç½®android:process=":remote" å±æ€§è®© Service è¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹ã€‚

## Serviceä¸Activityæ€ä¹ˆå®ç°é€šä¿¡

-é€šè¿‡Binderå¯¹è±¡

å½“Activityé€šè¿‡è°ƒç”¨bindService(Intent service, ServiceConnection conn,int flags),æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªServiceçš„ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®Serviceä¸­çš„æ–¹æ³•

-Activityè°ƒç”¨bindService (Intent service, ServiceConnection conn, int flags)æ–¹æ³•ï¼Œå¾—åˆ°Serviceå¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ï¼Œè¿™æ ·Activityå¯ä»¥ç›´æ¥è°ƒç”¨åˆ°Serviceä¸­çš„æ–¹æ³•ï¼Œå¦‚æœè¦ä¸»åŠ¨é€šçŸ¥Activityï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å›è°ƒæ–¹æ³•
-Serviceå‘Activityå‘é€æ¶ˆæ¯ï¼Œå¯ä»¥ä½¿ç”¨å¹¿æ’­ï¼Œå½“ç„¶Activityè¦æ³¨å†Œç›¸åº”çš„æ¥æ”¶å™¨ã€‚æ¯”å¦‚Serviceè¦å‘å¤šä¸ªActivityå‘é€åŒæ ·çš„æ¶ˆæ¯çš„è¯ï¼Œç”¨è¿™ç§æ–¹æ³•å°±æ›´å¥½ã€‚

## Serviceé‡Œé¢å¯ä»¥å¼¹å‡º dialog æˆ– Toast å—

å¯ä»¥ã€‚`getApplicationContext()`

## Service ä¸Šèƒ½ä¸èƒ½å¼¹å‡ºå¯¹è¯æ¡†

## ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Service?

æ¯”å¦‚æ’­æ”¾å¤šåª’ä½“çš„æ—¶å€™ç”¨æˆ·å¯åŠ¨äº†å…¶ä»–çš„Activityè¿™ä¸ªæ—¶å€™ç¨‹åºè¦åœ¨åå°ç»§ç»­æ’­æ”¾ï¼Œæ¯”å¦‚æ£€æµ‹SDå¡ä¸Šæ–‡ä»¶çš„å˜åŒ–ï¼Œåœ¨æˆ–è€…åœ¨åå°è®°å½•ä½ åœ°ç†ä½ç½®çš„æ”¹å˜ç­‰ç­‰

## è¯´è¯´Activityã€Intentã€Serviceæ˜¯ä»€ä¹ˆå…³ç³»

ä¸€ä¸ªActivityé€šå¸¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„å±å¹•ï¼Œæ¯ä¸€ä¸ªActivityéƒ½è¢«å®ç°ä¸ºä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œè¿™äº›ç±»éƒ½æ˜¯ä»ActivityåŸºç±»ä¸­ç»§æ‰¿æ¥çš„ï¼ŒActivityç±»æ˜¾ç¤ºæœ‰è§†å›¾æ§ä»¶ç»„æˆçš„ç”¨æˆ·æ¥å£ï¼Œå¹¶å¯¹è§†å›¾æ§ä»¶çš„äº‹ä»¶åšå‡ºå“åº”ã€‚

Intentçš„è°ƒç”¨æ˜¯ç”¨æ¥è¿›è¡Œæ¶æ„å±å¹•ä¹‹é—´çš„åˆ‡æ¢çš„ã€‚Intentæ˜¯æè¿°åº”ç”¨æƒ³è¦åšä»€ä¹ˆã€‚Intentæ•°æ®ç»“æœä¸­æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯åŠ¨ä½œå’ŒåŠ¨ä½œå¯¹åº”çš„æ•°æ®ï¼Œä¸€ä¸ªåŠ¨ä½œå¯¹åº”ä¸€ä¸ªåŠ¨ä½œæ•°æ®ã€‚

Serviceæ˜¯è¿è¡Œåœ¨åå°çš„ä»£ç ï¼Œä¸èƒ½ä¸ç”¨æˆ·äº¤äº’ï¼Œå¯ä»¥è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨å…¶ä»–åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡é‡Œã€‚éœ€è¦é€šè¿‡æŸä¸€ä¸ªActivityæˆ–å…¶ä»–Contextå¯¹è±¡æ¥è°ƒç”¨ã€‚ 

Activity è·³è½¬åˆ°Activity,Activtiyå¯åŠ¨Service,Serviceæ‰“å¼€Activityéƒ½éœ€è¦Intentè¡¨æ˜è·³è½¬çš„æ„å›¾ï¼Œä»¥åŠä¼ é€’å‚æ•°ï¼ŒIntentæ˜¯è¿™äº›ç»„ä»¶é—´ä¿¡å·ä¼ é€’çš„ä¼ æ‰¿è€…ã€‚

## æ€ä¹ˆåœ¨å¯åŠ¨ä¸€ä¸ªactivityæ—¶å°±å¯åŠ¨ä¸€ä¸ªservice

åœ¨activityçš„onCreateé‡Œå†™
startService(xxx);
ç„¶å
this.finish();ç»“æŸè‡ªå·±..
è¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³• å¯èƒ½ä¼šæœ‰å±å¹•ä¸€é—ªçš„ç°è±¡ï¼Œå¦‚æœUIè¦æ±‚ä¸¥æ ¼çš„è¯ç”¨AIDLæŠŠ

## Service å’Œ Activity ä¹‹é—´é€šè®¯çš„å‡ ç§æ–¹å¼

-é€šè¿‡ Binder å¯¹è±¡ã€‚
-é€šè¿‡ broadcast(å¹¿æ’­) çš„å½¢å¼ã€‚

Binder ç›¸å…³çŸ¥è¯†å‚è€ƒï¼šhttp://blog.csdn.net/boyupeng/article/details/47011383

## ä¸ºä»€ä¹ˆåœ¨Serviceä¸­åˆ›å»ºå­çº¿ç¨‹è€Œä¸æ˜¯Activityä¸­

è¿™æ˜¯å› ä¸ºActivityå¾ˆéš¾å¯¹Threadè¿›è¡Œæ§åˆ¶ï¼Œå½“Activityè¢«é”€æ¯ä¹‹åï¼Œå°±æ²¡æœ‰ä»»ä½•å…¶å®ƒçš„åŠæ³•å¯ä»¥å†é‡æ–°è·å–åˆ°ä¹‹å‰åˆ›å»ºçš„å­çº¿ç¨‹çš„å®ä¾‹ã€‚è€Œä¸”åœ¨ä¸€ä¸ªActivityä¸­åˆ›å»ºçš„å­çº¿ç¨‹ï¼Œå¦ä¸€ä¸ªActivityæ— æ³•å¯¹å…¶è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯Serviceå°±ä¸åŒäº†ï¼Œæ‰€æœ‰çš„Activityéƒ½å¯ä»¥ä¸Serviceè¿›è¡Œå…³è”ï¼Œç„¶åå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ“ä½œå…¶ä¸­çš„æ–¹æ³•ï¼Œå³ä½¿Activityè¢«é”€æ¯äº†ï¼Œä¹‹ååªè¦é‡æ–°ä¸Serviceå»ºç«‹å…³è”ï¼Œå°±åˆèƒ½å¤Ÿè·å–åˆ°åŸæœ‰çš„Serviceä¸­Binderçš„å®ä¾‹ã€‚å› æ­¤ï¼Œä½¿ç”¨Serviceæ¥å¤„ç†åå°ä»»åŠ¡ï¼ŒActivityå°±å¯ä»¥æ”¾å¿ƒåœ°finishï¼Œå®Œå…¨ä¸éœ€è¦æ‹…å¿ƒæ— æ³•å¯¹åå°ä»»åŠ¡è¿›è¡Œæ§åˆ¶çš„æƒ…å†µã€‚

## å¦‚ä½•ä¿è¯ Service åœ¨åå°ä¸è¢« kill

-onStartCommandæ–¹æ³•ï¼Œè¿”å›START_STICKY

START_STICKY åœ¨è¿è¡ŒonStartCommandåserviceè¿›ç¨‹è¢«killåï¼Œé‚£å°†ä¿ç•™åœ¨å¼€å§‹çŠ¶æ€ï¼Œä½†æ˜¯ä¸ä¿ç•™é‚£äº›ä¼ å…¥çš„intentã€‚ä¸ä¹…åserviceå°±ä¼šå†æ¬¡å°è¯•é‡æ–°åˆ›å»ºï¼Œå› ä¸ºä¿ç•™åœ¨å¼€å§‹çŠ¶æ€ï¼Œåœ¨åˆ›å»º     serviceåå°†ä¿è¯è°ƒç”¨onstartCommandã€‚å¦‚æœæ²¡æœ‰ä¼ é€’ä»»ä½•å¼€å§‹å‘½ä»¤ç»™serviceï¼Œé‚£å°†è·å–åˆ°nullçš„intentã€‚

START_NOT_STICKY åœ¨è¿è¡ŒonStartCommandåserviceè¿›ç¨‹è¢«killåï¼Œå¹¶ä¸”æ²¡æœ‰æ–°çš„intentä¼ é€’ç»™å®ƒã€‚Serviceå°†ç§»å‡ºå¼€å§‹çŠ¶æ€ï¼Œå¹¶ä¸”ç›´åˆ°æ–°çš„æ˜æ˜¾çš„æ–¹æ³•ï¼ˆstartServiceï¼‰è°ƒç”¨æ‰é‡æ–°åˆ›å»ºã€‚å› ä¸ºå¦‚æœæ²¡æœ‰ä¼ é€’ä»»ä½•æœªå†³å®šçš„intenté‚£ä¹ˆserviceæ˜¯ä¸ä¼šå¯åŠ¨ï¼Œä¹Ÿå°±æ˜¯æœŸé—´onstartCommandä¸ä¼šæ¥æ”¶åˆ°ä»»ä½•nullçš„intentã€‚

START_REDELIVER_INTENT åœ¨è¿è¡ŒonStartCommandåserviceè¿›ç¨‹è¢«killåï¼Œç³»ç»Ÿå°†ä¼šå†æ¬¡å¯åŠ¨serviceï¼Œå¹¶ä¼ å…¥æœ€åä¸€ä¸ªintentç»™onstartCommandã€‚ç›´åˆ°è°ƒç”¨stopSelf(int)æ‰åœæ­¢ä¼ é€’intentã€‚å¦‚æœåœ¨è¢«killåè¿˜æœ‰æœªå¤„ç†å¥½çš„intentï¼Œé‚£è¢«killåæœåŠ¡è¿˜æ˜¯ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚å› æ­¤onstartCommandä¸ä¼šæ¥æ”¶åˆ°ä»»ä½•nullçš„intentã€‚

-æå‡serviceä¼˜å…ˆçº§

åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­å¯¹äºintent-filterå¯ä»¥é€šè¿‡android:priority = "1000"è¿™ä¸ªå±æ€§è®¾ç½®æœ€é«˜ä¼˜å…ˆçº§ï¼Œ1000æ˜¯æœ€é«˜å€¼ï¼Œå¦‚æœæ•°å­—è¶Šå°åˆ™ä¼˜å…ˆçº§è¶Šä½ï¼ŒåŒæ—¶é€‚ç”¨äºå¹¿æ’­ã€‚

-æå‡serviceè¿›ç¨‹ä¼˜å…ˆçº§

Androidä¸­çš„è¿›ç¨‹æ˜¯æ‰˜ç®¡çš„ï¼Œå½“ç³»ç»Ÿè¿›ç¨‹ç©ºé—´ç´§å¼ çš„æ—¶å€™ï¼Œä¼šä¾ç…§ä¼˜å…ˆçº§è‡ªåŠ¨è¿›è¡Œè¿›ç¨‹çš„å›æ”¶ã€‚Androidå°†è¿›ç¨‹åˆ†ä¸º6ä¸ªç­‰çº§,å®ƒä»¬æŒ‰ä¼˜å…ˆçº§é¡ºåºç”±é«˜åˆ°ä½ä¾æ¬¡æ˜¯:

1.å‰å°è¿›ç¨‹( FOREGROUND_APP)
2.å¯è§†è¿›ç¨‹(VISIBLE_APP )
3.æ¬¡è¦æœåŠ¡è¿›ç¨‹(SECONDARY_SERVER )
4.åå°è¿›ç¨‹ (HIDDEN_APP)
5.å†…å®¹ä¾›åº”èŠ‚ç‚¹(CONTENT_PROVIDER)
6.ç©ºè¿›ç¨‹(EMPTY_APP)

å½“serviceè¿è¡Œåœ¨ä½å†…å­˜çš„ç¯å¢ƒæ—¶ï¼Œå°†ä¼škillæ‰ä¸€äº›å­˜åœ¨çš„è¿›ç¨‹ã€‚å› æ­¤è¿›ç¨‹çš„ä¼˜å…ˆçº§å°†ä¼šå¾ˆé‡è¦ï¼Œå¯ä»¥ä½¿ç”¨startForeground å°†serviceæ”¾åˆ°å‰å°çŠ¶æ€ã€‚è¿™æ ·åœ¨ä½å†…å­˜æ—¶è¢«killçš„å‡ ç‡ä¼šä½ä¸€äº›ã€‚

-onDestroyæ–¹æ³•é‡Œé‡å¯service

service +broadcast  æ–¹å¼ï¼Œå°±æ˜¯å½“serviceèµ°ondestoryçš„æ—¶å€™ï¼Œå‘é€ä¸€ä¸ªè‡ªå®šä¹‰çš„å¹¿æ’­ï¼Œå½“æ”¶åˆ°å¹¿æ’­çš„æ—¶å€™ï¼Œé‡æ–°å¯åŠ¨serviceï¼›

-ApplicationåŠ ä¸ŠPersistentå±æ€§
-ç›‘å¬ç³»ç»Ÿå¹¿æ’­åˆ¤æ–­ServiceçŠ¶æ€

é€šè¿‡ç³»ç»Ÿçš„ä¸€äº›å¹¿æ’­ï¼Œæ¯”å¦‚ï¼šæ‰‹æœºé‡å¯ã€ç•Œé¢å”¤é†’ã€åº”ç”¨çŠ¶æ€æ”¹å˜ç­‰ç­‰ç›‘å¬å¹¶æ•è·åˆ°ï¼Œç„¶ååˆ¤æ–­æˆ‘ä»¬çš„Serviceæ˜¯å¦è¿˜å­˜æ´»ï¼Œåˆ«å¿˜è®°åŠ æƒé™å•Šã€‚

## ä»€ä¹ˆæ˜¯IntentServiceï¼Ÿæœ‰ä½•ä¼˜ç‚¹ï¼Ÿ

IntentServiceä¹Ÿæ˜¯ä¸€ä¸ªServiceï¼Œæ˜¯Serviceçš„å­ç±»ï¼›
IntentServiceå’ŒServiceæœ‰æ‰€ä¸åŒï¼Œé€šè¿‡Looperå’ŒThreadæ¥è§£å†³æ ‡å‡†Serviceä¸­å¤„ç†é€»è¾‘çš„é˜»å¡çš„é—®é¢˜
ä¼˜ç‚¹ï¼šActivityçš„è¿›ç¨‹ï¼Œå½“å¤„ç†Intentçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„Service,Androidçš„è¿›ç¨‹å¤„ç†å™¨ç°åœ¨ä¼šå°½å¯èƒ½çš„ä¸killæ‰ä½ ã€‚

**IntentServiceçš„ä½¿ç”¨åœºæ™¯ä¸ç‰¹ç‚¹ã€‚**

> IntentServiceæ˜¯Serviceçš„å­ç±»ï¼Œæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ï¼Œä¼šè‡ªåŠ¨åœæ­¢çš„æœåŠ¡ï¼Œå¾ˆå¥½è§£å†³äº†ä¼ ç»Ÿçš„Serviceä¸­å¤„ç†å®Œè€—æ—¶æ“ä½œå¿˜è®°åœæ­¢å¹¶é”€æ¯Serviceçš„é—®é¢˜

ä¼˜ç‚¹ï¼š

- ä¸€æ–¹é¢ä¸éœ€è¦è‡ªå·±å»new Thread
- å¦ä¸€æ–¹é¢ä¸éœ€è¦è€ƒè™‘åœ¨ä»€ä¹ˆæ—¶å€™å…³é—­è¯¥Service

onStartCommandä¸­å›è°ƒäº†onStartï¼ŒonStartä¸­é€šè¿‡mServiceHandlerå‘é€æ¶ˆæ¯åˆ°è¯¥handlerçš„handleMessageä¸­å»ã€‚æœ€åhandleMessageä¸­å›è°ƒonHandleIntent(intent)ã€‚

# ContentProvider

å‚è€ƒï¼š[http://blog.csdn.net/coder_pig/article/details/47858489](http://blog.csdn.net/coder_pig/article/details/47858489)

## ContentProvider ç®€ä»‹

ContentProvider(å†…å®¹æä¾›è€…)ï¼šä¸ºå­˜å‚¨å’Œè·å–æ•°æ®æä¾›ç»Ÿä¸€çš„æ¥å£ã€‚å¯ä»¥åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®ã€‚Androidå·²ç»ä¸ºå¸¸è§çš„ä¸€äº›æ•°æ®æä¾›äº†é»˜è®¤çš„ContentProvider

1.ContentProvider ä¸ºå­˜å‚¨å’Œè¯»å–æ•°æ®æä¾›äº†ç»Ÿä¸€çš„æ¥å£
2.ä½¿ç”¨ContentProviderï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å®ç° app é—´æ•°æ®å…±äº«
3.Androidå†…ç½®çš„è®¸å¤šæ•°æ®éƒ½æ˜¯ä½¿ç”¨ContentProviderå½¢å¼ï¼Œä¾›å¼€å‘è€…è°ƒç”¨çš„(å¦‚è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå›¾ç‰‡ï¼Œé€šè®¯å½•ç­‰)

## è¯·ä»‹ç»ä¸‹ContentProvideræ˜¯å¦‚ä½•å®ç°æ•°æ®å…±äº«çš„

åˆ›å»ºä¸€ä¸ªå±äºä½ è‡ªå·±çš„Content provideræˆ–è€…å°†ä½ çš„æ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„Content providerä¸­ï¼Œå‰ææ˜¯æœ‰ç›¸åŒæ•°æ®ç±»å‹å¹¶ä¸”æœ‰å†™å…¥Content providerçš„æƒé™ã€‚

## ContentProviderä½¿ç”¨æ–¹æ³•

å‚è€ƒï¼š[http://blog.csdn.net/juetion/article/details/17481039](http://blog.csdn.net/juetion/article/details/17481039)

# Broadcast

## æ³¨å†Œå¹¿æ’­æœ‰å“ªå‡ ç§æ–¹å¼,æœ‰ä»€ä¹ˆåŒºåˆ«

-åœ¨åº”ç”¨ç¨‹åºçš„ä»£ç ä¸­æ³¨å†Œ

```java
registerReceiverï¼ˆreceiverï¼Œfilterï¼‰ï¼›// æ³¨å†ŒBroadcastReceiver

unregisterReceiverï¼ˆreceiverï¼‰ï¼›// å–æ¶ˆæ³¨å†ŒBroadcastReceiver
```

å½“BroadcastReceiveræ›´æ–°UIï¼Œé€šå¸¸ä¼šä½¿ç”¨è¿™æ ·çš„æ–¹æ³•æ³¨å†Œã€‚å¯åŠ¨Activityæ—¶å€™æ³¨å†ŒBroadcastReceiverï¼ŒActivityä¸å¯è§æ—¶å€™ï¼Œå–æ¶ˆæ³¨å†Œã€‚

-åœ¨androidmanifest.xmlå½“ä¸­æ³¨å†Œ

```java
<receiver>

    <intent-filter>

     <action Android:name = "android.intent.action.PICK"/>

    </intent-filter>

</receiver>
```

1)ç¬¬ä¸€ç§ä¸æ˜¯å¸¸é©»å‹å¹¿æ’­ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¿æ’­è·Ÿéšç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚

2)ç¬¬äºŒç§æ˜¯å¸¸é©»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´å½“åº”ç”¨ç¨‹åºå…³é—­åï¼Œå¦‚æœæœ‰ä¿¡æ¯å¹¿æ’­æ¥ï¼Œç¨‹åºä¹Ÿä¼šè¢«ç³»ç»Ÿè°ƒç”¨è‡ªåŠ¨è¿è¡Œã€‚

- é™æ€æ³¨å†Œï¼šåœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è¿›è¡Œæ³¨å†Œï¼Œå½“Appé€€å‡ºåï¼ŒReceiverä»ç„¶å¯ä»¥æ¥æ”¶åˆ°å¹¿æ’­å¹¶ä¸”è¿›è¡Œç›¸åº”çš„å¤„ç†
- åŠ¨æ€æ³¨å†Œï¼šåœ¨ä»£ç ä¸­åŠ¨æ€æ³¨å†Œï¼Œå½“Appé€€å‡ºåï¼Œä¹Ÿå°±æ²¡åŠæ³•å†æ¥å—å¹¿æ’­äº†

## Androidå¼•å…¥å¹¿æ’­æœºåˆ¶çš„ç”¨æ„ï¼Ÿ

## æ— åºå¹¿æ’­ã€æœ‰åºå¹¿æ’­

## æœ¬åœ°å¹¿æ’­å’Œå…¨å±€å¹¿æ’­æœ‰ä»€ä¹ˆå·®åˆ«

å…¨å±€å¹¿æ’­ BroadcastReceiver æ˜¯é’ˆå¯¹åº”ç”¨é—´ã€åº”ç”¨ä¸ç³»ç»Ÿé—´ã€åº”ç”¨å†…éƒ¨è¿›è¡Œé€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚

æœ¬åœ°å¹¿æ’­ LocalBroadcastReceiver ä»…åœ¨è‡ªå·±çš„åº”ç”¨å†…å‘é€æ¥æ”¶å¹¿æ’­ï¼Œä¹Ÿå°±æ˜¯åªæœ‰è‡ªå·±çš„åº”ç”¨èƒ½æ”¶åˆ°ã€‚å› å¹¿æ’­æ•°æ®åœ¨æœ¬åº”ç”¨èŒƒå›´å†…ä¼ æ’­ï¼Œä¸ç”¨æ‹…å¿ƒéšç§æ•°æ®æ³„éœ²çš„é—®é¢˜ã€‚ ä¸ç”¨æ‹…å¿ƒåˆ«çš„åº”ç”¨ä¼ªé€ å¹¿æ’­ï¼Œé€ æˆå®‰å…¨éšæ‚£ã€‚ ç›¸æ¯”åœ¨ç³»ç»Ÿå†…å‘é€å…¨å±€å¹¿æ’­ï¼Œå®ƒæ›´é«˜æ•ˆã€‚

## å…³äºä¸€ä¸ª app è¢«æ€æ‰è¿›ç¨‹åï¼Œæ˜¯å¦è¿˜èƒ½æ”¶åˆ°å¹¿æ’­

## IntentService ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŒAIDL è§£å†³äº†ä»€ä¹ˆé—®é¢˜

IntentService æ˜¯ç»§æ‰¿äº Service å¹¶å¤„ç†å¼‚æ­¥è¯·æ±‚çš„ä¸€ä¸ªç±»ï¼Œåœ¨IntentService å†…æœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¤„ç†è€—æ—¶æ“ä½œï¼Œå¯åŠ¨ IntentService çš„æ–¹å¼å’Œå¯åŠ¨ä¼ ç»Ÿ Service ä¸€æ ·ï¼ŒåŒæ—¶ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œåï¼ŒIntentService ä¼šè‡ªåŠ¨åœæ­¢ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬å»æ‰‹åŠ¨æ§åˆ¶ã€‚å¦å¤–ï¼Œå¯ä»¥å¯åŠ¨ IntentService å¤šæ¬¡ï¼Œè€Œæ¯ä¸€ä¸ªè€—æ—¶æ“ä½œä¼šä»¥å·¥ä½œé˜Ÿåˆ—çš„æ–¹å¼åœ¨ IntentService çš„ onHandleIntent å›è°ƒæ–¹æ³•ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”ï¼Œæ¯æ¬¡åªä¼šæ‰§è¡Œä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ‰§è¡Œå®Œç¬¬ä¸€ä¸ªå†æ‰§è¡Œç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ã€‚

IntentService ä¸ Serviceçš„ä¸åŒï¼š

-ç›´æ¥ åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„å·¥ä½œçº¿ç¨‹,è¯¥çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰çš„intentä¼ é€’ç»™onStartCommand()åŒºåˆ«äºåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ã€‚
-ç›´æ¥åˆ›å»ºä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—,å°†ä¸€ä¸ªæ„å›¾ä¼ é€’ç»™ä½ onHandleIntent()çš„å®ç°,æ‰€ä»¥æˆ‘ä»¬å°±æ°¸è¿œä¸å¿…æ‹…å¿ƒå¤šçº¿ç¨‹ã€‚
-å½“è¯·æ±‚å®Œæˆåè‡ªå·±ä¼šè°ƒç”¨stopSelf()ï¼Œæ‰€ä»¥ä½ å°±ä¸ç”¨è°ƒç”¨è¯¥æ–¹æ³•äº†ã€‚
-æä¾›çš„é»˜è®¤å®ç°onBind()è¿”å›nullï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚so easyå•Š
-æä¾›äº†ä¸€ä¸ªé»˜è®¤å®ç°onStartCommand(),å°†æ„å›¾å·¥ä½œé˜Ÿåˆ—,ç„¶åå‘é€åˆ°ä½ onHandleIntent()å®ç°ã€‚çœŸæ˜¯å¤ªæ–¹ä¾¿äº†

AIDL (Android Interface Definition Language) æ˜¯ä¸€ç§IDL è¯­è¨€ï¼Œç”¨äºç”Ÿæˆå¯ä»¥åœ¨ Android è®¾å¤‡ä¸Šä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡(interprocess communication, IPC)çš„ä»£ç ã€‚å¦‚æœåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ˆä¾‹å¦‚Activityï¼‰è¦è°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ˆä¾‹å¦‚ Service, è®¾ç½®äº†å±æ€§ android:process=":remote" åï¼ŒService å°±ä¼šè¿è¡Œåœ¨å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼‰å¯¹è±¡çš„æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨AIDLç”Ÿæˆå¯åºåˆ—åŒ–çš„å‚æ•°ã€‚ AIDL IPCæœºåˆ¶æ˜¯é¢å‘æ¥å£çš„ï¼ŒåƒCOMæˆ–Corbaä¸€æ ·ï¼Œä½†æ˜¯æ›´åŠ è½»é‡çº§ã€‚å®ƒæ˜¯ä½¿ç”¨ä»£ç†ç±»åœ¨å®¢æˆ·ç«¯å’Œå®ç°ç«¯ä¼ é€’æ•°æ®ã€‚



## AIDLçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å·¥ä½œï¼Ÿèƒ½å¤„ç†å“ªäº›ç±»å‹çš„æ•°æ®

ADILæ˜¯ä¸€ç§æ¥å£å®šä¹‰è¯­è¨€ï¼Œç”¨äºçº¦æŸä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡è§„åˆ™ï¼Œä¾›ç¼–è¯‘å™¨ç”Ÿæˆä»£ç ï¼Œå®ç°androidè®¾å¤‡ä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ã€‚

è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¿¡æ¯é¦–å…ˆä¼šè¢«è½¬æ¢æˆAIDLåè®®æ¶ˆæ¯ï¼Œç„¶åå‘é€ç»™å¯¹æ–¹ï¼Œå¯¹æ–¹å—åˆ°AIDLåè®®æ¶ˆæ¯ååœ¨è½¬æ¢æˆç›¸åº”çš„å¯¹è±¡ã€‚AIDLæ”¯æŒç±»å‹åŒ…æ‹¬javaåŸºç¡€ç±»å‹å’ŒStringï¼ŒListï¼ŒMap,CharSequence,å¦‚æœä½¿ç”¨è‡ªå®šç±»å‹ï¼Œå¿…é¡»å®ç°Parcelableæ¥å£

## Broadcastã€Content Provider å’Œ AIDLçš„åŒºåˆ«å’Œè”ç³»

è¿™3ç§éƒ½å¯ä»¥å®ç°è·¨è¿›ç¨‹çš„é€šä¿¡ï¼Œé‚£ä¹ˆä»æ•ˆç‡ï¼Œé€‚ç”¨èŒƒå›´ï¼Œå®‰å…¨æ€§ç­‰æ–¹é¢æ¥æ¯”è¾ƒçš„è¯ä»–ä»¬3è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Broadcastï¼šç”¨äºå‘é€å’Œæ¥æ”¶å¹¿æ’­ï¼å®ç°ä¿¡æ¯çš„å‘é€å’Œæ¥æ”¶ï¼
AIDLï¼šç”¨äºä¸åŒç¨‹åºé—´æœåŠ¡çš„ç›¸äº’è°ƒç”¨ï¼å®ç°äº†ä¸€ä¸ªç¨‹åºä¸ºå¦ä¸€ä¸ªç¨‹åºæœåŠ¡çš„åŠŸèƒ½ï¼
Content Provider:ç”¨äºå°†ç¨‹åºçš„æ•°æ®åº“äººä¸ºåœ°æš´éœ²å‡ºæ¥ï¼å®ç°ä¸€ä¸ªç¨‹åºå¯ä»¥å¯¹å¦ä¸ªç¨‹åºçš„æ•°æ®åº“è¿›è¡Œç›¸å¯¹ç”¨çš„æ“ä½œï¼

Broadcast,æ—¢ç„¶æ˜¯å¹¿æ’­ï¼Œé‚£ä¹ˆå®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šæ³¨å†Œäº†è¿™ä¸ªå¹¿æ’­æ¥æ”¶å™¨çš„åº”ç”¨éƒ½èƒ½å¤Ÿæ”¶åˆ°å¹¿æ’­ï¼ŒèŒƒå›´å¹¿ã€‚
ç¼ºç‚¹æ˜¯ï¼šé€Ÿåº¦æ…¢ç‚¹ï¼Œè€Œä¸”å¿…é¡»åœ¨ä¸€å®šæ—¶é—´å†…æŠŠäº‹æƒ…å¤„ç†å®Œ(onReceiveæ‰§è¡Œå¿…é¡»åœ¨å‡ ç§’ä¹‹å†…)ï¼Œå¦åˆ™çš„è¯ç³»ç»Ÿç»™å‡ºANRã€‚

AIDLï¼Œæ˜¯è¿›ç¨‹é—´é€šä¿¡ç”¨çš„ï¼Œç±»ä¼¼ä¸€ç§åè®®å§ã€‚ä¼˜ç‚¹æ˜¯ï¼šé€Ÿåº¦å¿«(ç³»ç»Ÿåº•å±‚ç›´æ¥æ˜¯å…±äº«å†…å­˜)ï¼Œæ€§èƒ½ç¨³ï¼Œæ•ˆç‡é«˜ï¼Œä¸€èˆ¬è¿›ç¨‹é—´é€šä¿¡å°±ç”¨å®ƒã€‚

Content Provider,å› ä¸ºåªæ˜¯æŠŠè‡ªå·±çš„æ•°æ®åº“æš´éœ²å‡ºå»ï¼Œå…¶ä»–ç¨‹åºéƒ½å¯ä»¥æ¥è·å–æ•°æ®ï¼Œæ•°æ®æœ¬èº«ä¸æ˜¯å®æ—¶çš„ï¼Œä¸åƒå‰ä¸¤è€…,åªæ˜¯èµ·ä¸ªæ•°æ®ä¾›åº”ä½œç”¨ã€‚ä¸€èˆ¬æ˜¯æŸä¸ªæˆç†Ÿçš„åº”ç”¨æ¥æš´éœ²è‡ªå·±çš„æ•°æ®ç”¨çš„ã€‚ ä½ è¦æ˜¯ä¸ºäº†è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜æ˜¯åˆ«ç”¨è¿™ä¸ªäº†ï¼Œè¿™ä¸ªåˆä¸æ˜¯å®æ—¶æ•°æ®ã€‚

# Intent

**Intentçš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥ä¼ é€’å“ªäº›æ•°æ®ç±»å‹ã€‚**

é€šè¿‡æŸ¥è¯¢Intent/Bundleçš„APIæ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥è·çŸ¥ï¼ŒIntent/Bundleæ”¯æŒä¼ é€’åŸºæœ¬ç±»å‹çš„æ•°æ®å’ŒåŸºæœ¬ç±»å‹çš„æ•°ç»„æ•°æ®ï¼Œä»¥åŠString/CharSequenceç±»å‹çš„æ•°æ®å’ŒString/CharSequenceç±»å‹çš„æ•°ç»„æ•°æ®ã€‚è€Œå¯¹äºå…¶å®ƒç±»å‹çš„æ•°æ®è²Œä¼¼æ— èƒ½ä¸ºåŠ›ï¼Œå…¶å®ä¸ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Intent/Bundleçš„APIä¸­çœ‹åˆ°Intent/Bundleè¿˜å¯ä»¥ä¼ é€’Parcelableï¼ˆåŒ…è£¹åŒ–ï¼Œé‚®åŒ…ï¼‰å’ŒSerializableï¼ˆåºåˆ—åŒ–ï¼‰ç±»å‹çš„æ•°æ®ï¼Œä»¥åŠå®ƒä»¬çš„æ•°ç»„/åˆ—è¡¨æ•°æ®ã€‚

æ‰€ä»¥è¦è®©éåŸºæœ¬ç±»å‹å’ŒéString/CharSequenceç±»å‹çš„æ•°æ®é€šè¿‡Intent/Bundleæ¥è¿›è¡Œä¼ è¾“ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ•°æ®ç±»å‹ä¸­å®ç°Parcelableæ¥å£æˆ–æ˜¯Serializableæ¥å£ã€‚

[http://blog.csdn.net/kkk0526/article/details/7214247](http://blog.csdn.net/kkk0526/article/details/7214247)

# Context

## ContextåŒºåˆ«

- Activityå’ŒServiceä»¥åŠApplicationçš„Contextæ˜¯ä¸ä¸€æ ·çš„,Activityç»§æ‰¿è‡ªContextThemeWraper.å…¶ä»–çš„ç»§æ‰¿è‡ªContextWrapper
- æ¯ä¸€ä¸ªActivityå’ŒServiceä»¥åŠApplicationçš„Contextéƒ½æ˜¯ä¸€ä¸ªæ–°çš„ContextImplå¯¹è±¡
- getApplication()ç”¨æ¥è·å–Applicationå®ä¾‹çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨Activityå’ŒServiceä¸­æ‰èƒ½è°ƒç”¨çš„åˆ°ã€‚é‚£ä¹ˆä¹Ÿè®¸åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯åœ¨Activityæˆ–è€…Serviceä¸­ä½¿ç”¨Applicationçš„ï¼Œä½†æ˜¯å¦‚æœåœ¨ä¸€äº›å…¶å®ƒçš„åœºæ™¯ï¼Œæ¯”å¦‚BroadcastReceiverä¸­ä¹Ÿæƒ³è·å¾—Applicationçš„å®ä¾‹ï¼Œè¿™æ—¶å°±å¯ä»¥å€ŸåŠ©getApplicationContext()æ–¹æ³•ï¼ŒgetApplicationContext()æ¯”getApplication()æ–¹æ³•çš„ä½œç”¨åŸŸä¼šæ›´å¹¿ä¸€äº›ï¼Œä»»ä½•ä¸€ä¸ªContextçš„å®ä¾‹ï¼Œåªè¦è°ƒç”¨getApplicationContext()æ–¹æ³•éƒ½å¯ä»¥æ‹¿åˆ°æˆ‘ä»¬çš„Applicationå¯¹è±¡ã€‚
- Activityåœ¨åˆ›å»ºçš„æ—¶å€™ä¼šnewä¸€ä¸ªContextImplå¯¹è±¡å¹¶åœ¨attachæ–¹æ³•ä¸­å…³è”å®ƒï¼ŒApplicationå’ŒServiceä¹Ÿå·®ä¸å¤šã€‚ContextWrapperçš„æ–¹æ³•å†…éƒ¨éƒ½æ˜¯è½¬è°ƒContextImplçš„æ–¹æ³•
- åˆ›å»ºå¯¹è¯æ¡†ä¼ å…¥Applicationçš„Contextæ˜¯ä¸å¯ä»¥çš„
- å°½ç®¡Applicationã€Activityã€Serviceéƒ½æœ‰è‡ªå·±çš„ContextImplï¼Œå¹¶ä¸”æ¯ä¸ªContextImpléƒ½æœ‰è‡ªå·±çš„mResourcesæˆå‘˜ï¼Œä½†æ˜¯ç”±äºå®ƒä»¬çš„mResourcesæˆå‘˜éƒ½æ¥è‡ªäºå”¯ä¸€çš„ResourcesManagerå®ä¾‹ï¼Œæ‰€ä»¥å®ƒä»¬çœ‹ä¼¼ä¸åŒçš„mResourceså…¶å®éƒ½æŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜
- Contextçš„æ•°é‡ç­‰äºActivityçš„ä¸ªæ•° + Serviceçš„ä¸ªæ•° + 1ï¼Œè¿™ä¸ª1ä¸ºApplication

#  Handler

## Handler åŸç†

andriodæä¾›äº†Handler å’Œ Looper æ¥æ»¡è¶³çº¿ç¨‹é—´çš„é€šä¿¡ã€‚Handlerå…ˆè¿›å…ˆå‡ºåŸåˆ™ã€‚Looperç±»ç”¨æ¥ç®¡ç†ç‰¹å®šçº¿ç¨‹å†…å¯¹è±¡ä¹‹é—´çš„æ¶ˆæ¯äº¤æ¢(MessageExchange)ã€‚

Looper: ä¸€ä¸ªçº¿ç¨‹å¯ä»¥äº§ç”Ÿä¸€ä¸ªLooperå¯¹è±¡ï¼Œç”±å®ƒæ¥ç®¡ç†æ­¤çº¿ç¨‹é‡Œçš„MessageQueue(æ¶ˆæ¯é˜Ÿåˆ—)ã€‚

Handler: ä½ å¯ä»¥æ„é€ Handlerå¯¹è±¡æ¥ä¸Looperæ²Ÿé€šï¼Œä»¥ä¾¿pushæ–°æ¶ˆæ¯åˆ°MessageQueueé‡Œ;æˆ–è€…æ¥æ”¶Looperä»Message Queueå–å‡º)æ‰€é€æ¥çš„æ¶ˆæ¯ã€‚

Message Queue(æ¶ˆæ¯é˜Ÿåˆ—):ç”¨æ¥å­˜æ”¾çº¿ç¨‹æ”¾å…¥çš„æ¶ˆæ¯ã€‚

çº¿ç¨‹ï¼šUIthread é€šå¸¸å°±æ˜¯main threadï¼Œè€ŒAndroidå¯åŠ¨ç¨‹åºæ—¶ä¼šæ›¿å®ƒå»ºç«‹ä¸€ä¸ªMessageQueueã€‚

å‚è€ƒï¼š[Handlerã€Looperã€Messageã€MessageQueueåŸºç¡€æµç¨‹åˆ†æ](https://github.com/GeniusVJR/LearningNotes/blob/master/Part1/Android/%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.md)

## Handleræ¶ˆæ¯æœºåˆ¶ï¼ŒpostDelayedä¼šé€ æˆçº¿ç¨‹é˜»å¡å—ï¼Ÿå¯¹å†…å­˜æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ



## Handlerã€Thread å’Œ HandlerThread çš„åŒºåˆ«

å‚è€ƒï¼šhttp://www.juwends.com/tech/android/android_thread_handler.html

Handler ä¼šå…³è”ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚Handleré»˜è®¤å…³è”ä¸»çº¿ç¨‹(å³ UI çº¿ç¨‹)ï¼Œè™½ç„¶è¦æä¾›Runnableå‚æ•° ï¼Œä½†é»˜è®¤æ˜¯ç›´æ¥è°ƒç”¨Runnableä¸­çš„run()æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤ä¸‹ä¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æœåœ¨è¿™é‡Œé¢çš„æ“ä½œä¼šæœ‰é˜»å¡ï¼Œç•Œé¢ä¹Ÿä¼šå¡ä½ã€‚å¦‚æœè¦åœ¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ HandlerThreadã€‚

HandlerThreadç»§æ‰¿äºThreadï¼Œæ‰€ä»¥å®ƒæœ¬è´¨å°±æ˜¯ä¸ªThreadã€‚ä¸æ™®é€šThreadçš„å·®åˆ«å°±åœ¨äºï¼Œä¸»è¦çš„ä½œç”¨æ˜¯å»ºç«‹äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”åˆ›ç«‹äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ‰è‡ªå·±çš„looper,å¯ä»¥è®©æˆ‘ä»¬åœ¨è‡ªå·±çš„çº¿ç¨‹ä¸­åˆ†å‘å’Œå¤„ç†æ¶ˆæ¯ã€‚

android.os.Handlerå¯ä»¥é€šè¿‡Looperå¯¹è±¡å®ä¾‹åŒ–ï¼Œå¹¶è¿è¡Œäºå¦å¤–çš„çº¿ç¨‹ä¸­ï¼ŒAndroidæä¾›äº†è®©Handlerè¿è¡Œäºå…¶å®ƒçº¿ç¨‹çš„çº¿ç¨‹å®ç°ï¼Œä¹Ÿæ˜¯å°±HandlerThreadã€‚HandlerThreadå¯¹è±¡startåå¯ä»¥è·å¾—å…¶Looperå¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸ªLooperå¯¹è±¡å®ä¾‹Handlerã€‚

## ä½¿ç”¨ Handler æ—¶æ€ä¹ˆé¿å…å¼•èµ·å†…å­˜æ³„æ¼

å‚è€ƒï¼š[Handlerå†…å­˜æ³„æ¼åˆ†æåŠè§£å†³](http://www.jianshu.com/p/cb9b4b71a820)

# AsyncTask

## AsyncTaskåŸç†



# çº¿ç¨‹

## å­çº¿ç¨‹ä¸­æ›´æ–°UIçš„æ–¹æ³•

ç¬¬ä¸€ç§ï¼šHandler+Message

ç¬¬äºŒç§ï¼š

```
new Handler(context.getMainLooper()).post(
  new Runnable(){
    public void run(){
    //æ›´æ–°UI
    }
  });
```

ç¬¬ä¸‰ç§ï¼š

```
((Activity)context)runOnUiThread(
  new Runnable(){
    public void run(){
      //æ›´æ–°UI
    }
  }
  );
```

## å¤šçº¿ç¨‹

- ç»§æ‰¿ Thread ç±»
- å®ç° Runnable æ¥å£
- HandlerThread
- Handler
- AsyncTask
- Activity.runOnUiThread(Runnable)
- View.post(Runnable),View.postDelay(Runnable,long)

## çº¿ç¨‹åŒæ­¥

å‚è€ƒï¼šhttp://www.itzhai.com/java-based-notebook-thread-synchronization-problem-solving-synchronization-problems-synchronized-block-synchronized-methods.html#2.1%E3%80%81%E4%BD%BF%E7%94%A8synchronized%E5%85%B3%E9%94%AE%E5%AD%97%E5%88%9B%E5%BB%BAsynchronized%E6%96%B9%E6%B3%95%EF%BC%9A

http://www.juwends.com/tech/android/android-inter-thread-comm.html

- ä½¿ç”¨ synchronized å…³é”®å­—åˆ›å»º synchronized æ–¹æ³•ã€‚
- ä½¿ç”¨ synchronized åˆ›å»ºåŒæ­¥ä»£ç å—ã€‚

# è¿›ç¨‹

## è¿›ç¨‹ä¼˜å…ˆçº§

- å‰å°è¿›ç¨‹
- å¯è§†è¿›ç¨‹
- æœåŠ¡è¿›ç¨‹
- åå°è¿›ç¨‹
- ç©ºè¿›ç¨‹

## è¿›ç¨‹é—´ä¼ è¾“æ–¹å¼

## Androidè¿›ç¨‹é—´é€šä¿¡ï¼ŒBinderæœºåˆ¶



# è§¦æ‘¸äº‹ä»¶

## View äº‹ä»¶åˆ†å‘æœºåˆ¶

WindowManager->window->Decorview->å­ viewã€‚æœ€åæˆ‘è¯´å½“æ‰€æœ‰çš„ view éƒ½ä¸å¤„ç†äº‹ä»¶ï¼Œäº‹ä»¶ä¼šæœ€åä¼šä¼ é€’åˆ° Activity çš„ onTouchEvent ä¸Š

## Touch äº‹ä»¶ä¼ é€’æµç¨‹

Androidäº‹ä»¶çš„åŸºç¡€çŸ¥è¯†ï¼š

æ‰€æœ‰çš„Touchäº‹ä»¶éƒ½å°è£…åˆ°MotionEventé‡Œé¢

äº‹ä»¶å¤„ç†åŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºï¼šä¼ é€’â€”-dispatchTouchEvent()å‡½æ•°ã€æ‹¦æˆªâ€”â€”onInterceptTouchEvent()å‡½æ•°ã€æ¶ˆè´¹â€”-onTouchEvent()å‡½æ•°å’ŒOnTouchListener

äº‹ä»¶ç±»å‹åˆ†ä¸ºACTION_DOWN, ACTION_UP, ACTION_MOVE, ACTION_POINTER_DOWN, ACTION_POINTER_UP, ACTION_CANCELç­‰ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½æ˜¯ä»¥ACTION_DOWNå¼€å§‹ACTION_UPç»“æŸ

Androidäº‹ä»¶ä¼ é€’æµç¨‹ï¼š

äº‹ä»¶éƒ½æ˜¯ä»Activity.dispatchTouchEvent()å¼€å§‹ä¼ é€’

äº‹ä»¶ç”±çˆ¶Viewä¼ é€’ç»™å­Viewï¼ŒViewGroupå¯ä»¥é€šè¿‡onInterceptTouchEvent()æ–¹æ³•å¯¹äº‹ä»¶æ‹¦æˆªï¼Œåœæ­¢å…¶å‘å­viewä¼ é€’

å¦‚æœäº‹ä»¶ä»ä¸Šå¾€ä¸‹ä¼ é€’è¿‡ç¨‹ä¸­ä¸€ç›´æ²¡æœ‰è¢«åœæ­¢ï¼Œä¸”æœ€åº•å±‚å­Viewæ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ï¼Œäº‹ä»¶ä¼šåå‘å¾€ä¸Šä¼ é€’ï¼Œè¿™æ—¶çˆ¶View(ViewGroup)å¯ä»¥è¿›è¡Œæ¶ˆè´¹ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰è¢«æ¶ˆè´¹çš„è¯ï¼Œæœ€åä¼šåˆ°Activityçš„onTouchEvent()å‡½æ•°ã€‚

å¦‚æœViewæ²¡æœ‰å¯¹ACTION_DOWNè¿›è¡Œæ¶ˆè´¹ï¼Œä¹‹åçš„å…¶ä»–äº‹ä»¶ä¸ä¼šä¼ é€’è¿‡æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ACTION_DOWNå¿…é¡»è¿”å›trueï¼Œä¹‹åçš„äº‹ä»¶æ‰ä¼šä¼ é€’è¿›æ¥

OnTouchListenerä¼˜å…ˆäºonTouchEvent()å¯¹äº‹ä»¶è¿›è¡Œæ¶ˆè´¹

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-14/18162238.jpg)

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-14/44984087.jpg)

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-14/48753378.jpg)

## onInterceptTouchEvent()å’ŒonTouchEvent()çš„åŒºåˆ«ï¼Ÿ

onInterceptTouchEvent()ç”¨äºæ‹¦æˆªè§¦æ‘¸äº‹ä»¶
onTouchEvent()ç”¨äºå¤„ç†è§¦æ‘¸äº‹ä»¶

# View

## View ç»˜åˆ¶æµç¨‹

å‚è€ƒï¼šhttp://www.codekk.com/blogs/detail/54cfab086c4761e5001b253f

å½“ Activity æ¥æ”¶åˆ°ç„¦ç‚¹çš„æ—¶å€™ï¼Œå®ƒä¼šè¢«è¯·æ±‚ç»˜åˆ¶å¸ƒå±€,è¯¥è¯·æ±‚ç”± Android framework å¤„ç†.ç»˜åˆ¶æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹å¸ƒå±€æ ‘è¿›è¡Œ measure å’Œ drawã€‚æ•´ä¸ª View æ ‘çš„ç»˜å›¾æµç¨‹åœ¨ViewRoot.javaç±»çš„performTraversals()å‡½æ•°å±•å¼€ï¼Œè¯¥å‡½æ•°æ‰€åš çš„å·¥ä½œå¯ç®€å•æ¦‚å†µä¸ºæ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—è§†å›¾å¤§å°(measure)ã€æ˜¯å¦éœ€è¦é‡æ–°å®‰ç½®è§†å›¾çš„ä½ç½®(layout)ã€ä»¥åŠæ˜¯å¦éœ€è¦é‡ç»˜(draw)ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š

![](http://o9sn2y8lr.bkt.clouddn.com/view_mechanism_flow.png)

![](http://o9sn2y8lr.bkt.clouddn.com/view_draw_method_chain.png)

## requertlayout onlayout onDraw drawChild çš„åŒºåˆ«å’Œè”ç³»

- requestLayout()æ–¹æ³• ï¼šä¼šå¯¼è‡´è°ƒç”¨measure()è¿‡ç¨‹ å’Œ layout()è¿‡ç¨‹ ã€‚ å°†ä¼šæ ¹æ®æ ‡å¿—ä½åˆ¤æ–­æ˜¯å¦éœ€è¦ondraw
- onLayout()æ–¹æ³•(å¦‚æœè¯¥Viewæ˜¯ViewGroupå¯¹è±¡ï¼Œéœ€è¦å®ç°è¯¥æ–¹æ³•ï¼Œå¯¹æ¯ä¸ªå­è§†å›¾è¿›è¡Œå¸ƒå±€)
- è°ƒç”¨onDraw()æ–¹æ³•ç»˜åˆ¶è§†å›¾æœ¬èº«   (æ¯ä¸ªViewéƒ½éœ€è¦é‡è½½è¯¥æ–¹æ³•ï¼ŒViewGroupä¸éœ€è¦å®ç°è¯¥æ–¹æ³•)
- drawChild()å»é‡æ–°å›è°ƒæ¯ä¸ªå­è§†å›¾çš„draw()æ–¹æ³•

## invalidata() å’Œ postInvalidata() çš„åŒºåˆ«åŠä½¿ç”¨

- invalidata() å¿…é¡»åœ¨ UI çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯é…åˆ Handler ä½¿ç”¨ã€‚
- postInvalidata() å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ç›´æ¥è°ƒç”¨ã€‚



## View åˆ·æ–°æœºåˆ¶

ç”± ViewRootå¯¹è±¡çš„performTraversals()æ–¹æ³•è°ƒç”¨draw()æ–¹æ³•å‘èµ·ç»˜åˆ¶è¯¥Viewæ ‘ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯æ¯æ¬¡å‘èµ·ç»˜å›¾æ—¶ï¼Œå¹¶ä¸ä¼šé‡æ–°ç»˜åˆ¶æ¯ä¸ªViewæ ‘çš„è§†å›¾ï¼Œè€Œåªä¼šé‡æ–°ç»˜åˆ¶é‚£äº›â€œéœ€è¦é‡ç»˜â€çš„è§†å›¾ï¼ŒViewç±»å†…éƒ¨å˜é‡åŒ…å«äº†ä¸€ä¸ªæ ‡å¿—ä½DRAWNï¼Œå½“è¯¥è§†å›¾éœ€è¦é‡ç»˜æ—¶ï¼Œå°±ä¼šä¸ºè¯¥Viewæ·»åŠ è¯¥æ ‡å¿—ä½ã€‚

è°ƒç”¨æµç¨‹ ï¼š

mView.draw()å¼€å§‹ç»˜åˆ¶ï¼Œdraw()æ–¹æ³•å®ç°çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

1. ç»˜åˆ¶è¯¥Viewçš„èƒŒæ™¯
2. ä¸ºæ˜¾ç¤ºæ¸å˜æ¡†åšä¸€äº›å‡†å¤‡æ“ä½œ(è§5ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ”¹æ¸å˜æ¡†)          
3. è°ƒç”¨onDraw()æ–¹æ³•ç»˜åˆ¶è§†å›¾æœ¬èº«   (æ¯ä¸ªViewéƒ½éœ€è¦é‡è½½è¯¥æ–¹æ³•ï¼ŒViewGroupä¸éœ€è¦å®ç°è¯¥æ–¹æ³•)
4. è°ƒç”¨dispatchDraw ()æ–¹æ³•ç»˜åˆ¶å­è§†å›¾(å¦‚æœè¯¥Viewç±»å‹ä¸ä¸ºViewGroupï¼Œå³ä¸åŒ…å«å­è§†å›¾ï¼Œä¸éœ€è¦é‡è½½è¯¥æ–¹æ³•)å€¼å¾—è¯´æ˜çš„æ˜¯ï¼ŒViewGroupç±»å·²ç»ä¸ºæˆ‘ä»¬é‡å†™äº†dispatchDraw ()çš„åŠŸèƒ½å®ç°ï¼Œåº”ç”¨ç¨‹åºä¸€èˆ¬ä¸éœ€è¦é‡å†™è¯¥æ–¹æ³•ï¼Œä½†å¯ä»¥é‡è½½çˆ¶ç±»å‡½æ•°å®ç°å…·ä½“çš„åŠŸèƒ½ã€‚

å‚è€ƒï¼šhttp://blog.csdn.net/chenzhiqin20/article/details/8628952

Viewçš„ç»˜åˆ¶æµç¨‹æ˜¯ä»ViewRootçš„performTraversalsï¼ˆï¼‰æ–¹æ³•å¼€å§‹ï¼Œä¾æ¬¡ç»è¿‡measureï¼ˆï¼‰ï¼Œlayoutï¼ˆï¼‰å’Œdrawï¼ˆï¼‰ä¸‰ä¸ªè¿‡ç¨‹æ‰æœ€ç»ˆå°†ä¸€ä¸ªViewç»˜åˆ¶å‡ºæ¥ã€‚

## Android ç»˜å›¾æœºåˆ¶åŸç†

## ä¼˜åŒ–è‡ªå®šä¹‰ View

ä¸ºäº†åŠ é€Ÿä½ çš„viewï¼Œå¯¹äºé¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ï¼Œéœ€è¦å°½é‡å‡å°‘ä¸å¿…è¦çš„ä»£ç ã€‚å…ˆä»onDrawå¼€å§‹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ä¸åº”è¯¥åœ¨è¿™é‡Œåšå†…å­˜åˆ†é…çš„äº‹æƒ…ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´GCï¼Œä»è€Œå¯¼è‡´å¡é¡¿ã€‚åœ¨åˆå§‹åŒ–æˆ–è€…åŠ¨ç”»é—´éš™æœŸé—´åšåˆ†é…å†…å­˜çš„åŠ¨ä½œã€‚ä¸è¦åœ¨åŠ¨ç”»æ­£åœ¨æ‰§è¡Œçš„æ—¶å€™åšå†…å­˜åˆ†é…çš„äº‹æƒ…ã€‚

ä½ è¿˜éœ€è¦å°½å¯èƒ½çš„å‡å°‘onDrawè¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œå¤§å¤šæ•°æ—¶å€™å¯¼è‡´onDrawéƒ½æ˜¯å› ä¸ºè°ƒç”¨äº†invalidate().å› æ­¤è¯·å°½é‡å‡å°‘è°ƒç”¨invaildate()çš„æ¬¡æ•°ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œå°½é‡è°ƒç”¨å«æœ‰4ä¸ªå‚æ•°çš„invalidate()æ–¹æ³•è€Œä¸æ˜¯æ²¡æœ‰å‚æ•°çš„invalidate()ã€‚æ²¡æœ‰å‚æ•°çš„invalidateä¼šå¼ºåˆ¶é‡ç»˜æ•´ä¸ªviewã€‚

å¦å¤–ä¸€ä¸ªéå¸¸è€—æ—¶çš„æ“ä½œæ˜¯è¯·æ±‚layoutã€‚ä»»ä½•æ—¶å€™æ‰§è¡ŒrequestLayout()ï¼Œä¼šä½¿å¾—Android UIç³»ç»Ÿå»éå†æ•´ä¸ªViewçš„å±‚çº§æ¥è®¡ç®—å‡ºæ¯ä¸€ä¸ªviewçš„å¤§å°ã€‚å¦‚æœæ‰¾åˆ°æœ‰å†²çªçš„å€¼ï¼Œå®ƒä¼šéœ€è¦é‡æ–°è®¡ç®—å¥½å‡ æ¬¡ã€‚å¦å¤–éœ€è¦å°½é‡ä¿æŒViewçš„å±‚çº§æ˜¯æ‰å¹³åŒ–çš„ï¼Œè¿™æ ·å¯¹æé«˜æ•ˆç‡å¾ˆæœ‰å¸®åŠ©ã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ªå¤æ‚çš„UIï¼Œä½ åº”è¯¥è€ƒè™‘å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ViewGroupæ¥æ‰§è¡Œä»–çš„layoutæ“ä½œã€‚ä¸å†…ç½®çš„viewä¸åŒï¼Œè‡ªå®šä¹‰çš„viewå¯ä»¥ä½¿å¾—ç¨‹åºä»…ä»…æµ‹é‡è¿™ä¸€éƒ¨åˆ†ï¼Œè¿™é¿å…äº†éå†æ•´ä¸ªviewçš„å±‚çº§ç»“æ„æ¥è®¡ç®—å¤§å°ã€‚è¿™ä¸ªPieChart ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ç»§æ‰¿ViewGroupä½œä¸ºè‡ªå®šä¹‰viewçš„ä¸€éƒ¨åˆ†ã€‚PieChart æœ‰å­viewsï¼Œä½†æ˜¯å®ƒä»æ¥ä¸æµ‹é‡å®ƒä»¬ã€‚è€Œæ˜¯æ ¹æ®ä»–è‡ªèº«çš„layoutæ³•åˆ™ï¼Œç›´æ¥è®¾ç½®å®ƒä»¬çš„å¤§å°ã€‚

## postInvalidateä¸invalidateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- éƒ½ç”¨äºåˆ·æ–°ç•Œé¢
- postInvalidate()ç”¨åœ¨å­çº¿ç¨‹
- invalidate()ç”¨åœ¨ä¸»çº¿ç¨‹

## notifyDataSetChangedå’ŒnotifyDataSetInvalidatedçš„åŒºåˆ«

- notifyDataSetInvalidated()ï¼Œä¼šé‡ç»˜æ•´ä¸ªæ§ä»¶ï¼ˆè¿˜åŸåˆ°åˆå§‹çŠ¶æ€ï¼‰
- notifyDataSetChanged()ï¼Œé‡ç»˜å½“å‰å¯è§åŒºåŸŸ

## SurfaceViewå’ŒViewçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

SurfaceViewä¸­é‡‡ç”¨äº†åŒç¼“å­˜æŠ€æœ¯ï¼Œåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ›´æ–°ç•Œé¢
Viewåœ¨UIçº¿ç¨‹ä¸­æ›´æ–°ç•Œé¢

## RemoteViewåœ¨å“ªäº›åŠŸèƒ½ä¸­ä½¿ç”¨

APPwidgetå’ŒNotificationä¸­

## è‡ªå®šä¹‰Viewç›¸å…³æ–¹æ³•

## å¦‚ä½•è‡ªå®šä¹‰æ§ä»¶

1. è‡ªå®šä¹‰å±æ€§çš„å£°æ˜å’Œè·å–
   - åˆ†æéœ€è¦çš„è‡ªå®šä¹‰å±æ€§
   - åœ¨res/values/attrs.xmlå®šä¹‰å£°æ˜
   - åœ¨layoutæ–‡ä»¶ä¸­è¿›è¡Œä½¿ç”¨
   - åœ¨Viewçš„æ„é€ æ–¹æ³•ä¸­è¿›è¡Œè·å–
2. æµ‹é‡onMeasure
3. å¸ƒå±€onLayout(ViewGroup)
4. ç»˜åˆ¶onDraw
5. onTouchEvent
6. onInterceptTouchEvent(ViewGroup)
7. çŠ¶æ€çš„æ¢å¤ä¸ä¿å­˜

# Layout å¸ƒå±€

## Androidä¸­å¸¸ç”¨çš„äº”ç§å¸ƒå±€

* FrameLayoutï¼ˆæ¡†æ¶å¸ƒå±€ï¼‰
* LinearLayout ï¼ˆçº¿æ€§å¸ƒå±€ï¼‰
* AbsoluteLayoutï¼ˆç»å¯¹å¸ƒå±€ï¼‰
* RelativeLayoutï¼ˆç›¸å¯¹å¸ƒå±€ï¼‰
* TableLayoutï¼ˆè¡¨æ ¼å¸ƒå±€ï¼‰

## LinearLayoutå’ŒRelativeLayoutæ€§èƒ½å¯¹æ¯”

1.RelativeLayoutä¼šè®©å­Viewè°ƒç”¨2æ¬¡onMeasureï¼ŒLinearLayout åœ¨æœ‰weightæ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨å­View2æ¬¡onMeasure
2.RelativeLayoutçš„å­Viewå¦‚æœé«˜åº¦å’ŒRelativeLayoutä¸åŒï¼Œåˆ™ä¼šå¼•å‘æ•ˆç‡é—®é¢˜ï¼Œå½“å­Viewå¾ˆå¤æ‚æ—¶ï¼Œè¿™ä¸ªé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ã€‚å¦‚æœå¯ä»¥ï¼Œå°½é‡ä½¿ç”¨paddingä»£æ›¿marginã€‚
3.åœ¨ä¸å½±å“å±‚çº§æ·±åº¦çš„æƒ…å†µä¸‹,ä½¿ç”¨LinearLayoutå’ŒFrameLayoutè€Œä¸æ˜¯RelativeLayoutã€‚

æœ€åå†æ€è€ƒä¸€ä¸‹æ–‡ç« å¼€å¤´é‚£ä¸ªçŸ›ç›¾çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆGoogleç»™å¼€å‘è€…é»˜è®¤æ–°å»ºäº†ä¸ªRelativeLayoutï¼Œè€Œè‡ªå·±å´åœ¨DecorViewä¸­ç”¨äº†ä¸ªLinearLayoutã€‚å› ä¸ºDecorViewçš„å±‚çº§æ·±åº¦æ˜¯å·²çŸ¥è€Œä¸”å›ºå®šçš„ï¼Œä¸Šé¢ä¸€ä¸ªæ ‡é¢˜æ ï¼Œä¸‹é¢ä¸€ä¸ªå†…å®¹æ ã€‚é‡‡ç”¨RelativeLayoutå¹¶ä¸ä¼šé™ä½å±‚çº§æ·±åº¦ï¼Œæ‰€ä»¥æ­¤æ—¶åœ¨æ ¹èŠ‚ç‚¹ä¸Šç”¨LinearLayoutæ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚è€Œä¹‹æ‰€ä»¥ç»™å¼€å‘è€…é»˜è®¤æ–°å»ºäº†ä¸ªRelativeLayoutæ˜¯å¸Œæœ›å¼€å‘è€…èƒ½é‡‡ç”¨å°½é‡å°‘çš„Viewå±‚çº§æ¥è¡¨è¾¾å¸ƒå±€ä»¥å®ç°æ€§èƒ½æœ€ä¼˜ï¼Œå› ä¸ºå¤æ‚çš„ViewåµŒå¥—å¯¹æ€§èƒ½çš„å½±å“ä¼šæ›´å¤§ä¸€äº›ã€‚

å‚è€ƒ ï¼šhttp://www.jianshu.com/p/8a7d059da746

## Androidä¸­px,sp,dip,dpçš„åŒºåˆ«ä¸è”ç³»

## Assetç›®å½•ä¸resç›®å½•çš„åŒºåˆ«ã€‚

res ç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œä¾‹å¦‚ drawable,mipmap,raw ç­‰ã€‚res ä¸‹é¢é™¤äº† raw 
æ–‡ä»¶ä¸ä¼šè¢«å‹ç¼©å¤–ï¼Œå…¶ä½™æ–‡ä»¶éƒ½ä¼šè¢«å‹ç¼©ã€‚åŒæ—¶ resç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥é€šè¿‡R æ–‡ä»¶è®¿é—®ã€‚Asset ä¹Ÿæ˜¯ç”¨æ¥å­˜å‚¨èµ„æºï¼Œä½†æ˜¯ asset 
æ–‡ä»¶å†…å®¹åªèƒ½é€šè¿‡è·¯å¾„æˆ–è€… AssetManager è¯»å–ã€‚ [å®˜æ–¹æ–‡æ¡£](https://developer.android.com/studio/projects/index.html)

# åŠ¨ç”»

## Androidå±æ€§åŠ¨ç”»ç‰¹æ€§

Android èµ·åˆæœ‰ä¸¤ç§åŠ¨ç”»ï¼šFrame Animationï¼ˆé€å¸§åŠ¨ç”»ï¼‰ Tween Animationï¼ˆè¡¥é—´åŠ¨ç”»ï¼‰,ä½†æ˜¯åœ¨ç”¨çš„æ—¶å€™å‘ç°è¿™ä¸¤ç§åŠ¨ç”»æœ‰æ—¶å€™å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„ä¸€äº›éœ€è¦ï¼Œæ‰€ä»¥Googleåœ¨Androi3.0çš„æ—¶å€™æ¨å‡ºäº†ï¼ˆProperty Animationï¼‰å±æ€§åŠ¨ç”»,è‡³äºä¸ºä»€ä¹ˆå‰è¾¹çš„ä¸¤ç§åŠ¨ç”»ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œè¯·å¾€ä¸‹çœ‹ï¼š

Frame Animation(é€å¸§åŠ¨ç”»)

é€å¸§åŠ¨ç”»å°±æ˜¯UIè®¾è®¡å¤šå¼ å›¾ç‰‡ç»„æˆä¸€ä¸ªåŠ¨ç”»ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆé“¾æ¥èµ·æ¥è¿›è¡ŒåŠ¨ç”»æ’­æ”¾ã€‚è¯¥æ–¹å¼ç±»ä¼¼äºæ—©æœŸç”µå½±çš„åˆ¶ä½œåŸç†ï¼šå…·ä½“å®ç°æ–¹å¼å°±ä¸å¤šè¯´äº†ï¼Œä½ åªéœ€è¦è®©ä½ ä»¬çš„UIå‡ºå¤šå¼ å›¾ç‰‡ï¼Œç„¶åä½ é¡ºåºçš„ç»„åˆå°±å¯ä»¥ï¼ˆå‰ææ˜¯UIç»™æ‚¨åšå›¾ï¼‰

Tween Animation(è¡¥é—´åŠ¨ç”») 

 Tween Animationï¼šæ˜¯å¯¹æŸä¸ªViewè¿›è¡Œä¸€ç³»åˆ—çš„åŠ¨ç”»çš„æ“ä½œï¼ŒåŒ…æ‹¬æ·¡å…¥æ·¡å‡ºï¼ˆAlphaï¼‰ï¼Œç¼©æ”¾ï¼ˆScaleï¼‰ï¼Œå¹³ç§»ï¼ˆTranslateï¼‰ï¼Œæ—‹è½¬ï¼ˆRotateï¼‰å››ç§æ¨¡å¼

Tween Animation(è¡¥é—´åŠ¨ç”»)çš„ä¸€äº›ç¼ºç‚¹ï¼š

1.Tween Animationï¼ˆè¡¥é—´åŠ¨ç”»ï¼‰åªæ˜¯é’ˆå¯¹äºViewï¼Œè¶…è„±äº†Viewå°±æ— æ³•æ“ä½œäº†ï¼Œè¿™å¥è¯çš„æ„æ€æ˜¯ï¼šå‡å¦‚æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªButtonï¼ŒImageViewï¼ŒLinearLayoutæˆ–è€…æ˜¯å…¶ä»–çš„ç»§æ‰¿è‡ªViewçš„å„ç§ç»„ä»¶è¿›è¡ŒåŠ¨ç”»çš„æ“ä½œæ—¶ï¼ŒTween Animationæ˜¯å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆæˆ‘ä»¬éœ€è¦å®Œæˆçš„åŠŸèƒ½çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ç”¨åˆ°å¯¹ä¸€ä¸ªéViewçš„å¯¹è±¡è¿›è¡ŒåŠ¨ç”»æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆè¡¥é—´åŠ¨ç”»å°±æ²¡åŠæ³•å®ç°äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„Viewï¼Œåœ¨è¿™ä¸ªViewä¸­æœ‰ä¸€ä¸ªPointå¯¹è±¡ç”¨äºç®¡ç†åæ ‡ï¼Œç„¶ååœ¨onDraw()æ–¹æ³•ä¸­çš„åæ ‡å°±æ˜¯æ ¹æ®è¯¥Pointdeåæ ‡å€¼è¿›è¡Œç»˜åˆ¶çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å¯¹Pointå¯¹è±¡è¿›è¡ŒåŠ¨ç”»æ“ä½œï¼Œé‚£ä¹ˆæ•´ä¸ªè‡ªå®šä¹‰çš„Viewï¼Œé‚£ä¹ˆæ•´ä¸ªè‡ªç»§æ‰¿Viewçš„å½“å‰ç±»å°±éƒ½æœ‰äº†åŠ¨ç”»ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸æƒ³è®©Viewæœ‰åŠ¨ç”»ï¼Œåªæ˜¯å¯¹åŠ¨ç”»ä¸­çš„Pointåæ ‡äº§ç”ŸåŠ¨ç”»ï¼Œè¿™æ ·è¡¥é—´åŠ¨ç”»å°±ä¸èƒ½æ»¡è¶³äº†ã€‚
2.Tween AnimationåŠ¨ç”»æœ‰å››ç§åŠ¨ç”»æ“ä½œï¼ˆç§»åŠ¨ï¼Œç¼©æ”¾ï¼Œæ—‹è½¬ï¼Œæ·¡å…¥æ·¡å‡ºï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªéœ€æ±‚å°±æ˜¯å°†å½“å‰Viewçš„èƒŒæ™¯è‰²è¿›è¡Œæ”¹å˜å‘¢ï¼ŸæŠ±æ­‰Tween Animationæ˜¯ä¸èƒ½å¸®åŠ©æˆ‘ä»¬å®ç°çš„ã€‚
3.Tween AnimationåŠ¨ç”»åªæ˜¯æ”¹å˜Viewçš„æ˜¾ç¤ºæ•ˆæœè€Œå·²ï¼Œä½†æ˜¯ä¸ä¼šçœŸæ­£çš„å»æ”¹å˜Viewçš„å±æ€§ï¼Œä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬ç°åœ¨å±å¹•çš„é¡¶éƒ¨æœ‰ä¸€ä¸ªå°çƒï¼Œç„¶åé€šè¿‡è¡¥é—´åŠ¨ç”»è®©ä»–ç§»åŠ¨åˆ°å³ä¸‹è§’ï¼Œç„¶åæˆ‘ä»¬ç»™è¿™ä¸ªå°çƒæ·»åŠ äº†ç‚¹å‡»äº‹ä»¶ï¼Œå¸Œæœ›ä½ç½®ç§»åŠ¨åˆ°å³ä¸‹è§’çš„æ—¶å€™ç‚¹å‡»å°çƒèƒ½çš„æ”¾å¤§å°çƒã€‚ä½†æ˜¯ç‚¹å‡»äº‹ä»¶æ˜¯ç»å¯¹ä¸ä¼šè§¦å‘çš„ï¼ŒåŸå› æ˜¯è¡¥é—´åŠ¨ç”»åªæ˜¯å°†è¯¥å°çƒç»˜åˆ¶åˆ°äº†å±å¹•çš„å³ä¸‹è§’ï¼Œå®é™…è¿™ä¸ªå°çƒè¿˜æ˜¯åœåœ¨å±å¹•çš„é¡¶éƒ¨ï¼Œæ‰€ä»¥ä½ åœ¨å³ä¸‹è§’ç‚¹å‡»æ˜¯æ²¡æœ‰ä»»ä½•ååº”çš„ã€‚

Property Animatior(å±æ€§åŠ¨ç”»)

å±æ€§åŠ¨ç”»æ˜¯Android3.0ä¹‹åå¼•è¿›çš„ï¼Œå®ƒæ›´æ”¹çš„æ˜¯åŠ¨ç”»çš„å®é™…å±æ€§ï¼Œåœ¨Tween Animation(è¡¥é—´åŠ¨ç”»)ä¸­ï¼Œå…¶æ”¹å˜çš„æ˜¯Viewçš„ç»˜åˆ¶æ•ˆæœï¼ŒçœŸæ­£çš„Viewçš„å±æ€§æ˜¯æ”¹å˜ä¸äº†çš„ï¼Œæ¯”å¦‚ä½ å°†ä½ çš„Buttonä½ç½®ç§»åŠ¨ä¹‹åä½ å†æ¬¡ç‚¹å‡»Buttonæ˜¯æ²¡æœ‰ä»»ä½•ç‚¹å‡»æ•ˆæœçš„ï¼Œæˆ–è€…æ˜¯ä½ å¦‚ä½•ç¼©æ”¾ä½ çš„Buttonå¤§å°ï¼Œç¼©æ”¾åçš„æœ‰æ•ˆçš„ç‚¹å‡»åŒºåŸŸè¿˜æ˜¯åªæœ‰ä½ å½“åˆåˆå§‹çš„Buttonçš„å¤§å°çš„ç‚¹å‡»åŒºåŸŸï¼Œå…¶ä½ç½®å’Œå¤§å°çš„å±æ€§å¹¶æ²¡æœ‰æ”¹å˜ã€‚è€Œåœ¨Property Animator(å±æ€§åŠ¨ç”»)ä¸­ï¼Œæ”¹å˜çš„æ˜¯åŠ¨ç”»çš„å®é™…å±æ€§ï¼Œå¦‚Buttonçš„ç¼©æ”¾ï¼ŒButtonçš„ä½ç½®å’Œå¤§å°å±æ€§å€¼éƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚è€Œä¸”Property Animationä¸æ­¢å¯ä»¥åº”ç”¨äºViewï¼Œè¿˜å¯ä»¥åº”ç”¨äºä»»ä½•å¯¹è±¡ï¼ŒProperty Animationåªæ˜¯è¡¨ç¤ºä¸€ä¸ªå€¼åœ¨ä¸€æ®µæ—¶é—´å†…çš„æ”¹å˜ï¼Œå½“å€¼æ”¹å˜æ—¶è¦åšä»€ä¹ˆäº‹æƒ…å®Œå…¨æ˜¯ä½ è‡ªå·±å†³å®šçš„ã€‚

## AndroidåŠ¨ç”»æ¡†æ¶å®ç°åŸç†

Animation æ¡†æ¶å®šä¹‰äº†é€æ˜åº¦ï¼Œæ—‹è½¬ï¼Œç¼©æ”¾å’Œä½ç§»å‡ ç§å¸¸è§çš„åŠ¨ç”»ï¼Œè€Œä¸”æ§åˆ¶çš„æ˜¯æ•´ä¸ªViewã€‚å®ç°åŸç†ï¼š

æ¯æ¬¡ç»˜åˆ¶è§†å›¾æ—¶ï¼ŒView æ‰€åœ¨çš„ ViewGroup ä¸­çš„ drawChild å‡½æ•°è·å–è¯¥View çš„ Animation çš„ Transformation å€¼ï¼Œç„¶åè°ƒç”¨canvas.concat(transformToApply.getMatrix())ï¼Œé€šè¿‡çŸ©é˜µè¿ç®—å®ŒæˆåŠ¨ç”»å¸§ï¼Œå¦‚æœåŠ¨ç”»æ²¡æœ‰å®Œæˆï¼Œç»§ç»­è°ƒç”¨ invalidate() å‡½æ•°ï¼Œå¯åŠ¨ä¸‹æ¬¡ç»˜åˆ¶æ¥é©±åŠ¨åŠ¨ç”»ï¼ŒåŠ¨ç”»è¿‡ç¨‹ä¸­çš„å¸§ä¹‹é—´é—´éš™æ—¶é—´æ˜¯ç»˜åˆ¶å‡½æ•°æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŠ¨ç”»æ¶ˆè€—æ¯”è¾ƒå¤šçš„CPUèµ„æºï¼Œæœ€é‡è¦çš„æ˜¯ï¼ŒåŠ¨ç”»æ”¹å˜çš„åªæ˜¯æ˜¾ç¤ºï¼Œå¹¶ä¸èƒ½ç›¸åº”äº‹ä»¶ã€‚

å‚è€ƒï¼šhttp://www.tuicool.com/articles/bYfYVv

# å›¾ç‰‡ç¼“å­˜

## å›¾ç‰‡ä¸‰çº§ç¼“å­˜å®ç°ï¼Ÿè‡ªå·±è®¾è®¡ä¸€ä¸ªå›¾ç‰‡åŠ è½½æ¡†æ¶

å‚è€ƒï¼šhttp://www.jianshu.com/p/2cd59a79ed4a

å‚è€ƒï¼šhttp://www.csdn.net/article/2015-10-21/2825984 â€” Android å›¾ç‰‡ç¼“å­˜å¼€æºåº“

## å¯¹ LruCache çš„ç†è§£

## Bitmap å‹ç¼©

```java
public static Bitmap create(byte[] bytes, int maxWidth, int maxHeight) {
â€‹		//ä¸Šé¢çš„çœç•¥äº†
â€‹        option.inJustDecodeBounds = true;
â€‹        BitmapFactory.decodeByteArray(bytes, 0, bytes.length, option);
â€‹        int actualWidth = option.outWidth;
â€‹        int actualHeight = option.outHeight;

â€‹        // è®¡ç®—å‡ºå›¾ç‰‡åº”è¯¥æ˜¾ç¤ºçš„å®½é«˜
â€‹        int desiredWidth = getResizedDimension(maxWidth, maxHeight, actualWidth, actualHeight);
â€‹        int desiredHeight = getResizedDimension(maxHeight, maxWidth, actualHeight, actualWidth);

â€‹        option.inJustDecodeBounds = false;
â€‹        option.inSampleSize = findBestSampleSize(actualWidth, actualHeight,
â€‹                desiredWidth, desiredHeight);
â€‹        Bitmap tempBitmap = BitmapFactory.decodeByteArray(bytes, 0, bytes.length, option);

â€‹        // åšç¼©æ”¾
â€‹        if (tempBitmap != null
â€‹                && (tempBitmap.getWidth() > desiredWidth || tempBitmap
â€‹                .getHeight() > desiredHeight)) {
â€‹            bitmap = Bitmap.createScaledBitmap(tempBitmap, desiredWidth,
â€‹                    desiredHeight, true);
â€‹            tempBitmap.recycle();
â€‹        } else {
â€‹            bitmap = tempBitmap;
â€‹        }
â€‹    }

â€‹    return bitmap;
}
```

ä½ è¿™ä¹ˆåšï¼ŒdecodeByteArrayä¸¤æ¬¡ä¸æ˜¯æ›´å å†…å­˜å—ï¼ŸğŸ˜‚ğŸ˜‚ğŸ˜‚ 

ç¬¬ä¸€æ¬¡è®¾ç½®inJustDecodeBounds = true æ—¶å€™æ˜¯ä¸å å†…å­˜çš„ï¼Œå› ä¸ºè¿”å›çš„æ˜¯null

ä¸€è„¸ä¸ç›¸ä¿¡æˆ‘çš„è¯´ï¼šå™¢ï¼Œè¿™åœ°æ–¹æˆ‘ä¸‹å»å†çœ‹çœ‹ã€‚

å“å¾—æˆ‘å›æ¥äº†ä»¥åèµ¶ç´§åˆçœ‹äº†çœ‹ï¼Œè¿˜å¥½æ²¡æœ‰è®°é”™ï¼Œè§æºç æ³¨é‡Š

```java
/**
* If set to true, the decoder will return null (no bitmap), but
* the out... fields will still be set, allowing the caller to query
* the bitmap without having to allocate the memory for its pixels.
    */
   public boolean inJustDecodeBounds;
```

## ARGB_8888å ç”¨å†…å­˜å¤§å°

é¦–å…ˆè¯´è¯´æœ¬é¢˜çš„ç­”æ¡ˆï¼Œæ˜¯4byteï¼Œå³ARGBå„å ç”¨8ä¸ªæ¯”ç‰¹æ¥æè¿°ã€‚å½“æ—¶å›ç­”é”™äº†ï¼Œè¯¦ç»†è§£ç­”çœ‹è¿™é‡Œ[ä½ çš„ Bitmap ç©¶ç«Ÿå å¤šå¤§å†…å­˜](http://bugly.qq.com/bbs/forum.php?mod=viewthread&tid=498) 

## å¦‚ä½•åˆ¤æ–­æœ¬åœ°ç¼“å­˜çš„æ—¶å€™æ•°æ®éœ€è¦ä»ç½‘ç»œç«¯è·å–



# ListView

## ListViewå¡é¡¿åŸå› 

1. åœ¨adapterä¸­çš„getViewæ–¹æ³•ä¸­å°½é‡å°‘ä½¿ç”¨é€»è¾‘
2. å°½æœ€å¤§å¯èƒ½é¿å…GC
3. æ»‘åŠ¨çš„æ—¶å€™ä¸åŠ è½½å›¾ç‰‡
4. å°†ListViewçš„scrollingCacheå’ŒanimateCacheè®¾ç½®ä¸ºfalse
5. itemçš„å¸ƒå±€å±‚çº§è¶Šçƒ§è¶Šå¥½
6. ä½¿ç”¨ViewHolder

## ListView çš„å®ç°åŸç†



## ä¸‹æ‹‰åˆ·æ–°å®ç°åŸç†

## RecyclerViewå’ŒListViewçš„å¼‚åŒ

å‚è€ƒï¼šhttp://www.tuicool.com/articles/aeeaQ3J

# å†…å­˜ç®¡ç†

## ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„æ¼

å‚è€ƒï¼š

[Androidå†…å­˜æ³„æ¼æ€»ç»“](https://github.com/GeniusVJR/LearningNotes/blob/master/Part1/Android/Android%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%80%BB%E7%BB%93.md)

[Handlerå†…å­˜æ³„æ¼åˆ†æåŠè§£å†³](http://www.jianshu.com/p/cb9b4b71a820)

å†…å­˜æ³„æ¼ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯è¯¥è¢«é‡Šæ”¾çš„å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œä¸€ç›´è¢«æŸä¸ªæˆ–æŸäº›å®ä¾‹æ‰€æŒæœ‰å´ä¸å†è¢«ä½¿ç”¨å¯¼è‡´ GC ä¸èƒ½å›æ”¶ã€‚

å†…å­˜æ³„æ¼æ˜¯æŒ‡æ— ç”¨å¯¹è±¡ï¼ˆä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼‰æŒç»­å æœ‰å†…å­˜æˆ–æ— ç”¨å¯¹è±¡çš„å†…å­˜å¾—ä¸åˆ°åŠæ—¶é‡Šæ”¾ï¼Œä»è€Œé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ç§°ä¸ºå†…å­˜æ³„æ¼ã€‚

1. èµ„æºå¯¹è±¡æ²¡å…³é—­é€ æˆçš„å†…å­˜æ³„æ¼ï¼Œä¾‹å¦‚ï¼šæ‰“å¼€æ•°æ®åº“ã€æ–‡ä»¶ç­‰
2. æ„é€ Adapteræ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨ç¼“å­˜çš„convertView
3. Bitmapå¯¹è±¡ä¸åœ¨ä½¿ç”¨æ—¶è°ƒç”¨recycle()é‡Šæ”¾å†…å­˜
4. è¯•ç€ä½¿ç”¨å…³äºapplicationçš„contextæ¥æ›¿ä»£å’Œactivityç›¸å…³çš„context
5. æ³¨å†Œæ²¡å–æ¶ˆé€ æˆçš„å†…å­˜æ³„æ¼
6. é›†åˆä¸­å¯¹è±¡æ²¡æ¸…ç†é€ æˆçš„å†…å­˜æ³„æ¼
7. å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨é€ æˆçš„å†…å­˜æ³„æ¼

- èµ„æºå¯¹è±¡æ²¡å…³é—­é€ æˆçš„å†…å­˜æ³„æ¼

æè¿°ï¼š èµ„æºæ€§å¯¹è±¡æ¯”å¦‚(Cursorï¼ŒFileæ–‡ä»¶ç­‰)å¾€å¾€éƒ½ç”¨äº†ä¸€äº›ç¼“å†²ï¼Œæˆ‘ä»¬åœ¨ä¸ä½¿ç”¨çš„æ—¶å€™ï¼Œåº”è¯¥åŠæ—¶å…³é—­å®ƒä»¬ï¼Œä»¥ä¾¿å®ƒä»¬çš„ç¼“å†²åŠæ—¶å›æ”¶å†…å­˜ã€‚å®ƒä»¬çš„ç¼“å†²ä¸ä»…å­˜åœ¨äº javaè™šæ‹Ÿæœºå†…ï¼Œè¿˜å­˜åœ¨äºjavaè™šæ‹Ÿæœºå¤–ã€‚å¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯æŠŠå®ƒçš„å¼•ç”¨è®¾ç½®ä¸ºnull,è€Œä¸å…³é—­å®ƒä»¬ï¼Œå¾€å¾€ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚å› ä¸ºæœ‰äº›èµ„æºæ€§å¯¹è±¡ï¼Œæ¯”å¦‚ SQLiteCursor(åœ¨ææ„å‡½æ•°finalize(),å¦‚æœæˆ‘ä»¬æ²¡æœ‰å…³é—­å®ƒï¼Œå®ƒè‡ªå·±ä¼šè°ƒclose()å…³é—­)ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å…³é—­å®ƒï¼Œç³»ç»Ÿåœ¨å›æ”¶å®ƒæ—¶ä¹Ÿä¼šå…³é—­å®ƒï¼Œä½†æ˜¯è¿™æ ·çš„æ•ˆç‡å¤ªä½äº†ã€‚å› æ­¤å¯¹äºèµ„æºæ€§å¯¹è±¡åœ¨ä¸ä½¿ç”¨çš„æ—¶å€™ï¼Œåº”è¯¥è°ƒç”¨å®ƒçš„close()å‡½æ•°ï¼Œå°†å…¶å…³é—­æ‰ï¼Œç„¶åæ‰ç½®ä¸ºnull.åœ¨æˆ‘ä»¬çš„ç¨‹åºé€€å‡ºæ—¶ä¸€å®šè¦ç¡®ä¿æˆ‘ä»¬çš„èµ„æºæ€§å¯¹è±¡å·²ç»å…³é—­ã€‚ ç¨‹åºä¸­ç»å¸¸ä¼šè¿›è¡ŒæŸ¥è¯¢æ•°æ®åº“çš„æ“ä½œï¼Œä½†æ˜¯ç»å¸¸ä¼šæœ‰ä½¿ç”¨å®Œæ¯•Cursoråæ²¡æœ‰å…³é—­çš„æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬çš„æŸ¥è¯¢ç»“æœé›†æ¯”è¾ƒå°ï¼Œå¯¹å†…å­˜çš„æ¶ˆè€—ä¸å®¹æ˜“è¢«å‘ç°ï¼Œåªæœ‰åœ¨å¸¸æ—¶é—´å¤§é‡æ“ä½œçš„æƒ…å†µä¸‹æ‰ä¼šå¤ç°å†…å­˜é—®é¢˜ï¼Œè¿™æ ·å°±ä¼šç»™ä»¥åçš„æµ‹è¯•å’Œé—®é¢˜æ’æŸ¥å¸¦æ¥å›°éš¾å’Œé£é™©ã€‚

2. æ„é€ Adapteræ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨ç¼“å­˜çš„convertView

æè¿°ï¼š ä»¥æ„é€ ListViewçš„BaseAdapterä¸ºä¾‹ï¼Œåœ¨BaseAdapterä¸­æä¾›äº†æ–¹æ³•ï¼š public View getView(int position, ViewconvertView, ViewGroup parent) æ¥å‘ListViewæä¾›æ¯ä¸€ä¸ªitemæ‰€éœ€è¦çš„viewå¯¹è±¡ã€‚åˆå§‹æ—¶ListViewä¼šä»BaseAdapterä¸­æ ¹æ®å½“å‰çš„å±å¹•å¸ƒå±€å®ä¾‹åŒ–ä¸€å®šæ•°é‡çš„ viewå¯¹è±¡ï¼ŒåŒæ—¶ListViewä¼šå°†è¿™äº›viewå¯¹è±¡ç¼“å­˜èµ·æ¥ã€‚å½“å‘ä¸Šæ»šåŠ¨ListViewæ—¶ï¼ŒåŸå…ˆä½äºæœ€ä¸Šé¢çš„list itemçš„viewå¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œç„¶åè¢«ç”¨æ¥æ„é€ æ–°å‡ºç°çš„æœ€ä¸‹é¢çš„list itemã€‚è¿™ä¸ªæ„é€ è¿‡ç¨‹å°±æ˜¯ç”±getView()æ–¹æ³•å®Œæˆçš„ï¼ŒgetView()çš„ç¬¬äºŒä¸ªå½¢å‚View convertViewå°±æ˜¯è¢«ç¼“å­˜èµ·æ¥çš„list itemçš„viewå¯¹è±¡(åˆå§‹åŒ–æ—¶ç¼“å­˜ä¸­æ²¡æœ‰viewå¯¹è±¡åˆ™convertViewæ˜¯null)ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬ä¸å»ä½¿ç”¨ convertViewï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½åœ¨getView()ä¸­é‡æ–°å®ä¾‹åŒ–ä¸€ä¸ªViewå¯¹è±¡çš„è¯ï¼Œå³æµªè´¹èµ„æºä¹Ÿæµªè´¹æ—¶é—´ï¼Œä¹Ÿä¼šä½¿å¾—å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤§ã€‚ ListViewå›æ”¶list itemçš„viewå¯¹è±¡çš„è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹: android.widget.AbsListView.java --> voidaddScrapView(View scrap) æ–¹æ³•ã€‚ ç¤ºä¾‹ä»£ç ï¼š

```
public View getView(int position, ViewconvertView, ViewGroup parent) {
View view = new Xxx(...); 
... ... 
return view; 
} 
```

ä¿®æ­£ç¤ºä¾‹ä»£ç ï¼š

```
public View getView(int position, ViewconvertView, ViewGroup parent) {
View view = null; 
if (convertView != null) { 
view = convertView; 
populate(view, getItem(position)); 
... 
} else { 
view = new Xxx(...); 
... 
} 
return view; 
} 
```

1. Bitmapå¯¹è±¡ä¸åœ¨ä½¿ç”¨æ—¶è°ƒç”¨recycle()é‡Šæ”¾å†…å­˜

æè¿°ï¼š æœ‰æ—¶æˆ‘ä»¬ä¼šæ‰‹å·¥çš„æ“ä½œBitmapå¯¹è±¡ï¼Œå¦‚æœä¸€ä¸ªBitmapå¯¹è±¡æ¯”è¾ƒå å†…å­˜ï¼Œå½“å®ƒä¸åœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è°ƒç”¨Bitmap.recycle()æ–¹æ³•å›æ”¶æ­¤å¯¹è±¡çš„åƒç´ æ‰€å ç”¨çš„å†…å­˜ï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œè§†æƒ…å†µè€Œå®šã€‚

1. è¯•ç€ä½¿ç”¨å…³äºapplicationçš„contextæ¥æ›¿ä»£å’Œactivityç›¸å…³çš„context

è¿™æ˜¯ä¸€ä¸ªå¾ˆéšæ™¦çš„å†…å­˜æ³„æ¼çš„æƒ…å†µã€‚æœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥é¿å…contextç›¸å…³çš„å†…å­˜æ³„æ¼ã€‚æœ€æ˜¾è‘—åœ°ä¸€ä¸ªæ˜¯é¿å…contexté€ƒå‡ºä»–è‡ªå·±çš„èŒƒå›´ä¹‹å¤–ã€‚ä½¿ç”¨Application contextã€‚è¿™ä¸ªcontextçš„ç”Ÿå­˜å‘¨æœŸå’Œä½ çš„åº”ç”¨çš„ç”Ÿå­˜å‘¨æœŸä¸€æ ·é•¿ï¼Œè€Œä¸æ˜¯å–å†³äºactivityçš„ç”Ÿå­˜å‘¨æœŸã€‚å¦‚æœä½ æƒ³ä¿æŒä¸€ä¸ªé•¿æœŸç”Ÿå­˜çš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡éœ€è¦ä¸€ä¸ªcontext,è®°å¾—ä½¿ç”¨applicationå¯¹è±¡ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ Context.getApplicationContext() or Activity.getApplication()æ¥è·å¾—ã€‚æ›´å¤šçš„è¯·çœ‹è¿™ç¯‡æ–‡ç« å¦‚ä½•é¿å… Androidå†…å­˜æ³„æ¼ã€‚

1. æ³¨å†Œæ²¡å–æ¶ˆé€ æˆçš„å†…å­˜æ³„æ¼

ä¸€äº›Androidç¨‹åºå¯èƒ½å¼•ç”¨æˆ‘ä»¬çš„Anroidç¨‹åºçš„å¯¹è±¡(æ¯”å¦‚æ³¨å†Œæœºåˆ¶)ã€‚å³ä½¿æˆ‘ä»¬çš„Androidç¨‹åºå·²ç»ç»“æŸäº†ï¼Œä½†æ˜¯åˆ«çš„å¼•ç”¨ç¨‹åºä»ç„¶è¿˜æœ‰å¯¹æˆ‘ä»¬çš„Androidç¨‹åºçš„æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæ³„æ¼çš„å†…å­˜ä¾ç„¶ä¸èƒ½è¢«åƒåœ¾å›æ”¶ã€‚è°ƒç”¨registerReceiveråæœªè°ƒç”¨unregisterReceiverã€‚ æ¯”å¦‚:å‡è®¾æˆ‘ä»¬å¸Œæœ›åœ¨é”å±ç•Œé¢(LockScreen)ä¸­ï¼Œç›‘å¬ç³»ç»Ÿä¸­çš„ç”µè¯æœåŠ¡ä»¥è·å–ä¸€äº›ä¿¡æ¯(å¦‚ä¿¡å·å¼ºåº¦ç­‰)ï¼Œåˆ™å¯ä»¥åœ¨LockScreenä¸­å®šä¹‰ä¸€ä¸ª PhoneStateListenerçš„å¯¹è±¡ï¼ŒåŒæ—¶å°†å®ƒæ³¨å†Œåˆ°TelephonyManageræœåŠ¡ä¸­ã€‚å¯¹äºLockScreenå¯¹è±¡ï¼Œå½“éœ€è¦æ˜¾ç¤ºé”å±ç•Œé¢çš„æ—¶å€™å°±ä¼šåˆ›å»ºä¸€ä¸ªLockScreenå¯¹è±¡ï¼Œè€Œå½“é”å±ç•Œé¢æ¶ˆå¤±çš„æ—¶å€™LockScreenå¯¹è±¡å°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚ ä½†æ˜¯å¦‚æœåœ¨é‡Šæ”¾ LockScreenå¯¹è±¡çš„æ—¶å€™å¿˜è®°å–æ¶ˆæˆ‘ä»¬ä¹‹å‰æ³¨å†Œçš„PhoneStateListenerå¯¹è±¡ï¼Œåˆ™ä¼šå¯¼è‡´LockScreenæ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœä¸æ–­çš„ä½¿é”å±ç•Œé¢æ˜¾ç¤ºå’Œæ¶ˆå¤±ï¼Œåˆ™æœ€ç»ˆä¼šç”±äºå¤§é‡çš„LockScreenå¯¹è±¡æ²¡æœ‰åŠæ³•è¢«å›æ”¶è€Œå¼•èµ·OutOfMemory,ä½¿å¾—system_process è¿›ç¨‹æŒ‚æ‰ã€‚ è™½ç„¶æœ‰äº›ç³»ç»Ÿç¨‹åºï¼Œå®ƒæœ¬èº«å¥½åƒæ˜¯å¯ä»¥è‡ªåŠ¨å–æ¶ˆæ³¨å†Œçš„(å½“ç„¶ä¸åŠæ—¶)ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯åº”è¯¥åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­æ˜ç¡®çš„å–æ¶ˆæ³¨å†Œï¼Œç¨‹åºç»“æŸæ—¶åº”è¯¥æŠŠæ‰€æœ‰çš„æ³¨å†Œéƒ½å–æ¶ˆæ‰ã€‚

1. é›†åˆä¸­å¯¹è±¡æ²¡æ¸…ç†é€ æˆçš„å†…å­˜æ³„æ¼

æˆ‘ä»¬é€šå¸¸æŠŠä¸€äº›å¯¹è±¡çš„å¼•ç”¨åŠ å…¥åˆ°äº†é›†åˆä¸­ï¼Œå½“æˆ‘ä»¬ä¸éœ€è¦è¯¥å¯¹è±¡æ—¶ï¼Œå¹¶æ²¡æœ‰æŠŠå®ƒçš„å¼•ç”¨ä»é›†åˆä¸­æ¸…ç†æ‰ï¼Œè¿™æ ·è¿™ä¸ªé›†åˆå°±ä¼šè¶Šæ¥è¶Šå¤§ã€‚å¦‚æœè¿™ä¸ªé›†åˆæ˜¯staticçš„è¯ï¼Œé‚£æƒ…å†µå°±æ›´ä¸¥é‡äº†ã€‚

## ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ OOM

å‚è€ƒï¼šhttp://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0920/3478.html

å¦‚æœé¿å… OOMï¼š

- å‡å°‘å¯¹è±¡çš„å†…å­˜å ç”¨

1. ä½¿ç”¨æ›´åŠ è½»é‡çš„æ•°æ®ç»“æ„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ ArrayMap æˆ– SparseArray è€Œä¸æ˜¯ HashMap ç­‰ä¼ ç»Ÿæ•°æ®ç»“æ„ã€‚
2. é¿å…åœ¨ Android é‡Œé¢ä½¿ç”¨ Enumã€‚
3. å‡å° Bitmap å¯¹è±¡çš„å†…å­˜å ç”¨ã€‚ç¼©æ”¾æ¯”ä¾‹ï¼Œè§£ç æ ¼å¼ã€‚
4. ä½¿ç”¨æ›´å°çš„å›¾ç‰‡ã€‚

- å†…å­˜å¯¹è±¡çš„é‡å¤åˆ©ç”¨

1. å¤ç”¨ç³»ç»Ÿè‡ªå¸¦çš„èµ„æºã€‚ä½†éœ€è¦ç•™æ„ä¸åŒç³»ç»Ÿç‰ˆæœ¬çš„å·®å¼‚æ€§ã€‚
2. åœ¨ ListView å’Œ GridView ç­‰å¤§é‡å‡ºç°é‡å¤å­ç»„ä»¶çš„è§†å›¾é‡Œå¯¹ ConvertView å¤ç”¨ã€‚
3. Bitmap å¯¹è±¡çš„å¤ç”¨ã€‚åœ¨  ListView å’Œ GridView ç­‰æ˜¾ç¤ºå¤§é‡å›¾ç‰‡çš„æ§ä»¶é‡Œï¼Œéœ€è¦ä½¿ç”¨ LRU çš„æœºåˆ¶æ¥ç¼“å­˜å¤„ç†å¥½çš„ Bitmapã€‚
4. é¿å…åœ¨ onDraw æ–¹æ³•é‡Œé¢æ‰§è¡Œå¯¹è±¡çš„åˆ›å»ºã€‚
5. ä½¿ç”¨å¤§é‡å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œæ˜¯ï¼Œè€ƒè™‘ä½¿ç”¨ StringBuffer ä»£æ›¿ â€œ+â€ã€‚

- é¿å…å¯¹è±¡çš„å†…å­˜æ³„æ¼

1. æ³¨æ„ Activity çš„æ³„æ¼ã€‚1ï¼‰å†…éƒ¨ç±»å¼•ç”¨å¯¼è‡´ Activity çš„æ³„æ¼ã€‚å…¸å‹çš„æ˜¯ Handler å¯¼è‡´çš„æ³„æ¼ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨UIé€€å‡ºä¹‹å‰ï¼Œæ‰§è¡Œremove Handleræ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸runnableå¯¹è±¡ã€‚æˆ–è€…æ˜¯ä½¿ç”¨Static + WeakReferenceçš„æ–¹å¼æ¥è¾¾åˆ°æ–­å¼€Handlerä¸Activityä¹‹é—´å­˜åœ¨å¼•ç”¨å…³ç³»çš„ç›®çš„ã€‚2ï¼‰Activity Contextè¢«ä¼ é€’åˆ°å…¶ä»–å®ä¾‹ä¸­ï¼Œè¿™å¯èƒ½å¯¼è‡´è‡ªèº«è¢«å¼•ç”¨è€Œå‘ç”Ÿæ³„æ¼ã€‚
2. è€ƒè™‘ä½¿ç”¨ Application Context è€Œä¸æ˜¯ Activity Contextã€‚å¯¹äºå¤§éƒ¨åˆ†éå¿…é¡»ä½¿ç”¨Activity Contextçš„æƒ…å†µï¼ˆDialogçš„Contextå°±å¿…é¡»æ˜¯Activity Contextï¼‰ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨Application Contextè€Œä¸æ˜¯Activityçš„Contextï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸ç»æ„çš„Activityæ³„éœ²ã€‚
3. æ³¨æ„ä¸´æ—¶Bitmapå¯¹è±¡çš„åŠæ—¶å›æ”¶ã€‚
4. æ³¨æ„ç›‘å¬å™¨çš„æ³¨é”€ã€‚
5. æ³¨æ„ç¼“å­˜å®¹å™¨ä¸­çš„å¯¹è±¡æ³„æ¼ã€‚
6. æ³¨æ„ WebView çš„æ³„æ¼ã€‚
7. æ³¨æ„ Cursor å¯¹è±¡æ˜¯å¦åŠæ—¶å…³é—­ã€‚



## ANR å®šä½å’Œä¿®æ­£

å¦‚æœå¼€å‘æœºå™¨ä¸Šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹/data/anr/traces.txtå³å¯ï¼Œæœ€æ–°çš„ANRä¿¡æ¯åœ¨æœ€å¼€å§‹éƒ¨åˆ†ã€‚

å‡ºç° ANR åŸå› ï¼š

- ä¸»çº¿ç¨‹è¢«IOæ“ä½œï¼ˆä»4.0ä¹‹åç½‘ç»œIOä¸å…è®¸åœ¨ä¸»çº¿ç¨‹ä¸­ï¼‰é˜»å¡ã€‚
- ä¸»çº¿ç¨‹ä¸­å­˜åœ¨è€—æ—¶çš„è®¡ç®—ã€‚
- ä¸»çº¿ç¨‹ä¸­é”™è¯¯çš„æ“ä½œï¼Œæ¯”å¦‚Thread.waitæˆ–è€…Thread.sleepç­‰ã€‚
- Androidç³»ç»Ÿä¼šç›‘æ§ç¨‹åºçš„å“åº”çŠ¶å†µï¼Œä¸€æ—¦å‡ºç°ä¸‹é¢ä¸¤ç§æƒ…å†µï¼Œåˆ™å¼¹å‡ºANRå¯¹è¯æ¡†ã€‚åº”ç”¨åœ¨5ç§’å†…æœªå“åº”ç”¨æˆ·çš„è¾“å…¥äº‹ä»¶ï¼ˆå¦‚æŒ‰é”®æˆ–è€…è§¦æ‘¸ï¼‰ï¼›BroadcastReceiveræœªåœ¨10ç§’å†…å®Œæˆç›¸å…³çš„å¤„ç†ã€‚
- Serviceåœ¨ç‰¹å®šçš„æ—¶é—´å†…æ— æ³•å¤„ç†å®Œæˆ 20ç§’

ä¿®æ­£æ–¹æ³•ï¼š

- ä½¿ç”¨AsyncTaskå¤„ç†è€—æ—¶IOæ“ä½œã€‚
- ä½¿ç”¨Threadæˆ–è€…HandlerThreadæ—¶ï¼Œè°ƒç”¨Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND)è®¾ç½®ä¼˜å…ˆçº§ï¼Œå¦åˆ™ä»ç„¶ä¼šé™ä½ç¨‹åºå“åº”ï¼Œå› ä¸ºé»˜è®¤Threadçš„ä¼˜å…ˆçº§å’Œä¸»çº¿ç¨‹ç›¸åŒã€‚
- ä½¿ç”¨Handlerå¤„ç†å·¥ä½œçº¿ç¨‹ç»“æœï¼Œè€Œä¸æ˜¯ä½¿ç”¨Thread.wait()æˆ–è€…Thread.sleep()æ¥é˜»å¡ä¸»çº¿ç¨‹ã€‚
- Activityçš„onCreateå’ŒonResumeå›è°ƒä¸­å°½é‡é¿å…è€—æ—¶çš„ä»£ç ã€‚
- BroadcastReceiverä¸­onReceiveä»£ç ä¹Ÿè¦å°½é‡å‡å°‘è€—æ—¶ï¼Œå»ºè®®ä½¿ç”¨IntentServiceå¤„ç†ã€‚

## Android ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ†é…çš„å†…å­˜å¤§å°æ˜¯å¤šå°‘

android ç¨‹åºå†…å­˜ä¸€èˆ¬é™åˆ¶åœ¨16Mï¼Œä¹Ÿæœ‰çš„æ˜¯24M

## æŸ¥çœ‹æ¯ä¸ªåº”ç”¨ç¨‹åºæœ€é«˜å¯ç”¨å†…å­˜

```java
    int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);  
    Log.d("TAG", "Max memory is " + maxMemory + "KB");  
```

## Androidä¸­å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åº”ç”¨åœºæ™¯ã€‚



# æ€§èƒ½ä¼˜åŒ–

å‚è€ƒï¼š[Androidæ€§èƒ½ä¼˜åŒ–](https://github.com/GeniusVJR/LearningNotes/blob/master/Part1/Android/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.md)

## æ€§èƒ½ä¼˜åŒ–ï¼ŒMAT



# æ•°æ®å­˜å‚¨

## æ•°æ®å­˜å‚¨ï¼Œæ•°æ®æŒä¹…åŒ–çš„æ–¹å¼æœ‰å“ªäº›

- SharedPreference
- æ•°æ®åº“SQLite
- æ–‡ä»¶
- ContentProviderå†…å®¹æä¾›è€…ï¼Œå¦‚è”ç³»äºº
- ç½‘ç»œ
- SQLiteï¼šSQLiteæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“ï¼Œæ”¯æŒåŸºæœ¬çš„SQLè¯­æ³•ï¼Œæ˜¯å¸¸è¢«é‡‡ç”¨çš„ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ã€‚Androidä¸ºæ­¤æ•°æ®åº“æä¾›äº†ä¸€ä¸ªåä¸ºSQLiteDatabaseçš„ç±»ï¼Œå°è£…äº†ä¸€äº›æ“ä½œæ•°æ®åº“çš„api
- SharedPreferenceï¼š é™¤SQLiteæ•°æ®åº“å¤–ï¼Œå¦ä¸€ç§å¸¸ç”¨çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œå¸¸ç”¨äºå­˜å‚¨è¾ƒç®€å•çš„å‚æ•°è®¾ç½®ã€‚
- Fileï¼š å³å¸¸è¯´çš„æ–‡ä»¶ï¼ˆI/Oï¼‰å­˜å‚¨æ–¹æ³•ï¼Œå¸¸ç”¨è¯­å­˜å‚¨å¤§æ•°é‡çš„æ•°æ®ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯æ›´æ–°æ•°æ®å°†æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹æƒ…ã€‚
- ContentProvider: Androidç³»ç»Ÿä¸­èƒ½å®ç°æ‰€æœ‰åº”ç”¨ç¨‹åºå…±äº«çš„ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œç”±äºæ•°æ®é€šå¸¸åœ¨å„åº”ç”¨é—´çš„æ˜¯äº’ç›¸ç§å¯†çš„ï¼Œæ‰€ä»¥æ­¤å­˜å‚¨æ–¹å¼è¾ƒå°‘ä½¿ç”¨ï¼Œä½†æ˜¯å…¶åˆæ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç§å­˜å‚¨æ–¹å¼ã€‚ä¾‹å¦‚éŸ³é¢‘ï¼Œè§†é¢‘ï¼Œå›¾ç‰‡å’Œé€šè®¯å½•ï¼Œä¸€èˆ¬éƒ½å¯ä»¥é‡‡ç”¨æ­¤ç§æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚æ¯ä¸ªContent Provideréƒ½ä¼šå¯¹å¤–æä¾›ä¸€ä¸ªå…¬å…±çš„URIï¼ˆåŒ…è£…æˆUriå¯¹è±¡ï¼‰ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæœ‰æ•°æ®éœ€è¦å…±äº«æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨Content Providerä¸ºè¿™äº›æ•°æ®å®šä¹‰ä¸€ä¸ªURIï¼Œç„¶åå…¶ä»–çš„åº”ç”¨ç¨‹åºå°±é€šè¿‡Content Providerä¼ å…¥è¿™ä¸ªURIæ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚

## æ–‡ä»¶å’Œæ•°æ®åº“å“ªä¸ªæ•ˆç‡é«˜



## SharedPreference å®ç°

## å¦‚ä½•å¯¼å…¥å¤–éƒ¨æ•°æ®åº“

æŠŠæ•°æ®åº“å­˜æ”¾åˆ° res/raw ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ç¬¬ä¸€æ¬¡å®‰è£…å¯åŠ¨åº”ç”¨çš„æ—¶é—´æŠŠè¯¥æ•°æ®åº“æ‹·è´åˆ°åº”ç”¨çš„å†…éƒ¨å­˜å‚¨ç©ºé—´å³ android ç³»ç»Ÿä¸‹çš„ /data/data/packagename/ ç›®å½•ä¸‹ã€‚



# ç½‘ç»œé€šè®¯

## æè¿°ä¸€æ¬¡ç½‘ç»œè¯·æ±‚çš„æµç¨‹

1. å»ºç«‹TCPè¿æ¥ åœ¨HTTPå·¥ä½œå¼€å§‹ä¹‹å‰ï¼ŒWebæµè§ˆå™¨é¦–å…ˆè¦é€šè¿‡ç½‘ç»œä¸WebæœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œè¯¥è¿æ¥æ˜¯é€šè¿‡TCPæ¥å®Œæˆçš„ï¼Œè¯¥åè®®ä¸IPåè®®å…±åŒæ„å»ºInternetï¼Œå³è‘—åçš„TCP/IPåè®®æ—ï¼Œå› æ­¤Internetåˆè¢«ç§°ä½œæ˜¯TCP/IPç½‘ç»œã€‚HTTPæ˜¯æ¯”TCPæ›´é«˜å±‚æ¬¡çš„åº”ç”¨å±‚åè®®ï¼Œæ ¹æ®è§„åˆ™ï¼Œåªæœ‰ä½å±‚åè®®å»ºç«‹ä¹‹åæ‰èƒ½è¿›è¡Œæ›´é«˜å±‚åè®®çš„è¿æ¥ï¼Œå› æ­¤ï¼Œé¦–å…ˆè¦å»ºç«‹TCPè¿æ¥ï¼Œä¸€èˆ¬TCPè¿æ¥çš„ç«¯å£å·æ˜¯80ã€‚
2. Webæµè§ˆå™¨å‘WebæœåŠ¡å™¨å‘é€è¯·æ±‚å‘½ä»¤ ä¸€æ—¦å»ºç«‹äº†TCPè¿æ¥ï¼ŒWebæµè§ˆå™¨å°±ä¼šå‘WebæœåŠ¡å™¨å‘é€è¯·æ±‚å‘½ä»¤ã€‚ä¾‹å¦‚ï¼šGET/sample/hello.jsp HTTP/1.1ã€‚
3. Webæµè§ˆå™¨å‘é€è¯·æ±‚å¤´ä¿¡æ¯ æµè§ˆå™¨å‘é€å…¶è¯·æ±‚å‘½ä»¤ä¹‹åï¼Œè¿˜è¦ä»¥å¤´ä¿¡æ¯çš„å½¢å¼å‘WebæœåŠ¡å™¨å‘é€ä¸€äº›åˆ«çš„ä¿¡æ¯ï¼Œä¹‹åæµè§ˆå™¨å‘é€äº†ä¸€ç©ºç™½è¡Œæ¥é€šçŸ¥æœåŠ¡å™¨ï¼Œå®ƒå·²ç»ç»“æŸäº†è¯¥å¤´ä¿¡æ¯çš„å‘é€ã€‚
4. WebæœåŠ¡å™¨åº”ç­” å®¢æˆ·æœºå‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šå®¢æˆ·æœºå›é€åº”ç­”ï¼Œ HTTP/1.1 200 OK ï¼Œåº”ç­”çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯åè®®çš„ç‰ˆæœ¬å·å’Œåº”ç­”çŠ¶æ€ç ã€‚
5. WebæœåŠ¡å™¨å‘é€åº”ç­”å¤´ä¿¡æ¯ æ­£å¦‚å®¢æˆ·ç«¯ä¼šéšåŒè¯·æ±‚å‘é€å…³äºè‡ªèº«çš„ä¿¡æ¯ä¸€æ ·ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šéšåŒåº”ç­”å‘ç”¨æˆ·å‘é€å…³äºå®ƒè‡ªå·±çš„æ•°æ®åŠè¢«è¯·æ±‚çš„æ–‡æ¡£ã€‚
6. WebæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€æ•°æ® WebæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€å¤´ä¿¡æ¯åï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªç©ºç™½è¡Œæ¥è¡¨ç¤ºå¤´ä¿¡æ¯çš„å‘é€åˆ°æ­¤ä¸ºç»“æŸï¼Œæ¥ç€ï¼Œå®ƒå°±ä»¥Content-Typeåº”ç­”å¤´ä¿¡æ¯æ‰€æè¿°çš„æ ¼å¼å‘é€ç”¨æˆ·æ‰€è¯·æ±‚çš„å®é™…æ•°æ®ã€‚
7. WebæœåŠ¡å™¨å…³é—­TCPè¿æ¥ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ—¦WebæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€äº†è¯·æ±‚æ•°æ®ï¼Œå®ƒå°±è¦å…³é—­TCPè¿æ¥ï¼Œç„¶åå¦‚æœæµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨åœ¨å…¶å¤´ä¿¡æ¯åŠ å…¥äº†è¿™è¡Œä»£ç ï¼šConnection:keep-alive

TCPè¿æ¥åœ¨å‘é€åå°†ä»ç„¶ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œäºæ˜¯ï¼Œæµè§ˆå™¨å¯ä»¥ç»§ç»­é€šè¿‡ç›¸åŒçš„è¿æ¥å‘é€è¯·æ±‚ã€‚ä¿æŒè¿æ¥èŠ‚çœäº†ä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹æ–°è¿æ¥æ‰€éœ€çš„æ—¶é—´ï¼Œè¿˜èŠ‚çº¦äº†ç½‘ç»œå¸¦å®½ã€‚

## æ¨é€å¿ƒè·³åŒ…æ˜¯TCPåŒ…è¿˜æ˜¯UDPåŒ…æˆ–è€…HTTPåŒ…

å…¶å®èŠèµ·è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºæœ€è¿‘çœ‹åˆ° [@ç¡ä¸ç€èµ·ä¸æ¥çš„ä¸‡å®µ](http://weibo.com/u/2951317192) åŒå­¦å†™çš„ä¸€ç¯‡æ–‡ç« ã€Š[Androidæ¨é€æŠ€æœ¯ç ”ç©¶](http://www.jianshu.com/p/584707554ed7)ã€‹ç»“æœå°±äº§ç”Ÿäº†è¿™ä¸ªæ²¡å›ç­”å‡ºæ¥çš„é—®é¢˜(å¦ˆè›‹ï¼Œè‡ªå·±ç»™è‡ªå·±æŒ–å‘ - -)
æœ€åçœ‹äº†è¿™ç¯‡æ–‡ç« (å¥½åƒæ˜¯è½¬çš„ï¼Œæ²¡æ‰¾åˆ°åŸåœ°å€)[android å¿ƒè·³çš„åˆ†æ](http://blog.csdn.net/wangliang198901/article/details/16542567)
åŸæ¥å¿ƒè·³åŒ…çš„å®ç°æ˜¯è°ƒç”¨äº†`socket.sendUrgentData(0xFF)`è¿™å¥ä»£ç å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå½“ç„¶æ˜¯TCPåŒ…ã€‚

## Android ä»£ç ä¸­å®ç° WAP æ–¹å¼è”ç½‘

-é€šè¿‡ APN åˆ—è¡¨ï¼Œè·å–ä»£ç æœåŠ¡å™¨å’Œç«¯å£å·ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œåˆ™è®¾ç½®æˆå¯¹åº”è¿è¥å•†çš„é…ç½®ã€‚
-å®ç° HtppClient ä»£ç†ã€‚

## æ–­ç‚¹ç»­ä¼ 



# åŠ¨æ€åŠ è½½

## æ’ä»¶åŒ–ï¼ŒåŠ¨æ€åŠ è½½



## Androidä¸­ClassLoaderå’Œjavaä¸­æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«ï¼Ÿ



# JNI

## JNIå¼€å‘æµç¨‹



# WebView

## WebViewå’ŒJS



# jar

## 65ké™åˆ¶ åšå†…éƒ¨åº“è®¾è®¡æ—¶ï¼Œæœ€é‡è¦çš„è€ƒè™‘æ˜¯jarçš„æˆæœ¬ï¼Œæ–¹æ³•æ•°ã€ä½“ç§¯ã€‚



# å…¶ä»–

## å¦‚ä½•åˆ¤æ–­åº”ç”¨è¢«å¼ºæ€

åœ¨Applicatioä¸­å®šä¹‰ä¸€ä¸ªstaticå¸¸é‡ï¼Œèµ‹å€¼ä¸ºï¼1ï¼Œåœ¨æ¬¢è¿ç•Œé¢æ”¹ä¸º0ï¼Œå¦‚æœè¢«å¼ºæ€ï¼Œapplicationé‡æ–°åˆå§‹åŒ–ï¼Œåœ¨çˆ¶ç±»Activityåˆ¤æ–­è¯¥å¸¸é‡çš„å€¼ã€‚

## åº”ç”¨è¢«å¼ºæ€å¦‚ä½•è§£å†³

å¦‚æœåœ¨æ¯ä¸€ä¸ªActivityçš„onCreateé‡Œåˆ¤æ–­æ˜¯å¦è¢«å¼ºæ€ï¼Œå†—ä½™äº†ï¼Œå°è£…åˆ°Activityçš„çˆ¶ç±»ä¸­ï¼Œå¦‚æœè¢«å¼ºæ€ï¼Œè·³è½¬å›ä¸»ç•Œé¢ï¼Œå¦‚æœæ²¡æœ‰è¢«å¼ºæ€ï¼Œæ‰§è¡ŒActivityçš„åˆå§‹åŒ–æ“ä½œï¼Œç»™ä¸»ç•Œé¢ä¼ é€’intentå‚æ•°ï¼Œä¸»ç•Œé¢ä¼šè°ƒç”¨onNewIntentæ–¹æ³•ï¼Œåœ¨onNewIntentè·³è½¬åˆ°æ¬¢è¿é¡µé¢ï¼Œé‡æ–°æ¥ä¸€éæµç¨‹ã€‚

## ç®€è¿°é™é»˜å®‰è£…çš„åŸç†ï¼Œå¦‚ä½•åœ¨æ— éœ€rootæƒé™çš„æƒ…å†µä¸‹å®ç°é™é»˜å®‰è£…ï¼Ÿ

## Serializableå’ŒParcelableçš„åŒºåˆ«

- éƒ½èƒ½å®ç°åºåˆ—åŒ–ä¸”å¯ç”¨äºIntenté—´çš„æ•°æ®ä¼ é€’
- Serializableæ˜¯Javaä¸­çš„åºåˆ—åŒ–æ¥å£ï¼Œä½¿ç”¨ç®€å•ä½†å¼€é”€å¤§ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹éœ€è¦å¤§é‡I/Oæ“ä½œã€‚
- Parcelableæ›´é€‚åˆAndroidå¹³å°ï¼Œä½¿ç”¨éº»çƒ¦ä½†æ•ˆç‡é«˜ï¼Œä¸»è¦ç”¨åœ¨å†…å­˜åºåˆ—åŒ–ä¸Šã€‚



## Debugå’ŒReleaseçŠ¶æ€çš„ä¸åŒ



## Toolbarçš„ä½¿ç”¨



## ä½ç‰ˆæœ¬ SDK å¦‚ä½•å®ç°é«˜ç‰ˆæœ¬ API

è‡ªå·±å®ç°æˆ–@TargetApi annotation

åœ¨ä½ç‰ˆæœ¬çš„ SDK ä½¿ç”¨é«˜ç‰ˆæœ¬çš„ API ä¼šæŠ¥é”™ã€‚è§£å†³æ–¹æ³•æ˜¯ï¼šåœ¨é«˜ç‰ˆæœ¬ SDK ä¸­ä½¿ç”¨é«˜ç‰ˆæœ¬ APIï¼Œä½ç‰ˆæœ¬ SDK ä¸­è‡ªå·±å®ç°ã€‚

- åœ¨ä½¿ç”¨äº†é«˜ç‰ˆæœ¬ API çš„æ–¹æ³•å‰é¢åŠ ä¸€ä¸ª @TargetApi(APIç‰ˆæœ¬å·)ã€‚
- åœ¨ä»£ç ä¸­åˆ¤æ–­ç‰ˆæœ¬å·æ¥æ§åˆ¶ä¸åŒçš„ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„ä»£ç ã€‚

```
@TargetApi(11) 
public void text() { 
if(Build.VERSION.SDK_INT >= 11){ 
	// ä½¿ç”¨ API 11 çš„æ–¹æ³•
} else {
	// ä½¿ç”¨è‡ªå·±å®ç°çš„æ–¹æ³•
}
```

## å®ç°ä¸€ä¸ªå•ä¾‹

```
public class Singleton{
private volatile static Singleton mSingleton;
private Singleton(){
}
public static Singleton getInstance(){
  if(mSingleton == null){\\A
    synchronized(Singleton.class){\\C
     if(mSingleton == null)
      mSingleton = new Singleton();\\B
      }
    }
    return mSingleton;
  }
}
```

# è®¾è®¡æ¨¡å¼

## Android ä¸­ä¸»è¦ç”¨åˆ°çš„å‡ ç§è®¾è®¡æ¨¡å¼



## Androidè®¾è®¡æ¨¡å¼

å‚è€ƒï¼šhttp://blog.csdn.net/bboyfeiyu/article/details/44563871

# æ¶æ„è®¾è®¡


## mvc mvp mvvm

å‚è€ƒï¼šhttp://www.tianmaying.com/tutorial/AndroidMVC

![](http://o9sn2y8lr.bkt.clouddn.com/16-10-19/71303594.jpg)

# Volley æºç è§£æ

å‚è€ƒï¼š[http://a.codekk.com/detail/Android/grumoon/Volley%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90](http://a.codekk.com/detail/Android/grumoon/Volley%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90)

### Volleyçš„ç£ç›˜ç¼“å­˜

åœ¨é¢è¯•çš„æ—¶å€™ï¼ŒèŠåˆ° Volley è¯·æ±‚åˆ°ç½‘ç»œçš„æ•°æ®ç¼“å­˜ã€‚å½“æ—¶è¯´åˆ°æ˜¯ Volley ä¼šå°†æ¯æ¬¡é€šè¿‡ç½‘ç»œè¯·æ±‚åˆ°çš„æ•°æ®ï¼Œé‡‡ç”¨`FileOutputStream`ï¼Œå†™å…¥åˆ°æœ¬åœ°çš„æ–‡ä»¶ä¸­ã€‚ 
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šè¿™ä¸ªç¼“å­˜æ–‡ä»¶ï¼Œæ˜¯å£°æ˜åœ¨ä¸€ä¸ªSDå¡æ–‡ä»¶å¤¹ä¸­çš„(ä¹Ÿå¯ä»¥æ˜¯getCacheFile())ã€‚å¦‚æœä¸åœçš„è¯·æ±‚ç½‘ç»œæ•°æ®ï¼Œè¿™ä¸ªç¼“å­˜æ–‡ä»¶å¤¹å°†æ— é™åˆ¶çš„å¢å¤§ï¼Œæœ€ç»ˆè¾¾åˆ°SDå¡å®¹é‡æ—¶ï¼Œä¼šå‘ç”Ÿæ— æ³•å†™å…¥çš„å¼‚å¸¸(å› ä¸ºå­˜å‚¨ç©ºé—´æ»¡äº†)ã€‚
è¿™ä¸ªé—®é¢˜çš„ç¡®ä»¥å‰æ²¡æœ‰æƒ³åˆ°ï¼Œå½“æ—¶ä¹Ÿæ²¡è¯´å‡ºæ€ä¹ˆå›äº‹ã€‚å›å®¶äº†èµ¶ç´§åˆçœ‹äº†çœ‹ä»£ç æ‰çŸ¥é“ï¼ŒåŸæ¥ Volley è€ƒè™‘è¿‡è¿™ä¸ªé—®é¢˜(æ±—!æƒ³æƒ³ä¹Ÿæ˜¯)
ç¿»çœ‹ä»£ç `DiskBasedCache#pruneIfNeeded()`

```
private void pruneIfNeeded(int neededSpace) {
    if ((mTotalSize + neededSpace) < mMaxCacheSizeInBytes) {
        return;
    }
    
    long before = mTotalSize;
    int prunedFiles = 0;
    long startTime = SystemClock.elapsedRealtime();

    Iterator<Map.Entry<String, CacheHeader>> iterator = mEntries.entrySet().iterator();
    while (iterator.hasNext()) {
        Map.Entry<String, CacheHeader> entry = iterator.next();
        CacheHeader e = entry.getValue();
        boolean deleted = getFileForKey(e.key).delete();
        if (deleted) {
            mTotalSize -= e.size;
        } else {
	//print log
        }
        iterator.remove();
        prunedFiles++;
        if ((mTotalSize + neededSpace) < mMaxCacheSizeInBytes * HYSTERESIS_FACTOR) {
            break;
        }
    }
}
```

å…¶ä¸­`mMaxCacheSizeInBytes`æ˜¯æ„é€ æ–¹æ³•ä¼ å…¥çš„ä¸€ä¸ªç¼“å­˜æ–‡ä»¶å¤¹çš„å¤§å°ï¼Œå¦‚æœä¸ä¼ é»˜è®¤æ˜¯5Mçš„å¤§å°ã€‚
é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å‘ç°ï¼Œæ¯å½“è¢«è°ƒç”¨æ—¶ä¼šä¼ å…¥ä¸€ä¸ª`neededSpace`ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç”³è¯·çš„ç£ç›˜å¤§å°(å³è¦æ–°ç¼“å­˜çš„é‚£ä¸ªæ–‡ä»¶æ‰€éœ€å¤§å°)ã€‚é¦–å…ˆä¼šåˆ¤æ–­å¦‚æœè¿™ä¸ª`neededSpace`ç”³è¯·æˆåŠŸä»¥åæ˜¯å¦ä¼šè¶…è¿‡æœ€å¤§å¯ç”¨å®¹é‡ï¼Œå¦‚æœä¼šè¶…è¿‡ï¼Œåˆ™é€šè¿‡éå†æœ¬åœ°å·²ç»ä¿å­˜çš„ç¼“å­˜æ–‡ä»¶çš„header(headerä¸­åŒ…å«äº†ç¼“å­˜æ–‡ä»¶çš„ç¼“å­˜æœ‰æ•ˆæœŸã€å ç”¨å¤§å°ç­‰ä¿¡æ¯)å»åˆ é™¤æ–‡ä»¶ï¼Œç›´åˆ°å¯ç”¨å®¹é‡ä¸å¤§äºå£°æ˜çš„ç¼“å­˜æ–‡ä»¶å¤¹çš„å¤§å°ã€‚ 
å…¶ä¸­`HYSTERESIS_FACTOR`æ˜¯ä¸€ä¸ªå€¼ä¸º0.9çš„å¸¸é‡ï¼Œåº”è¯¥æ˜¯ä¸ºäº†é˜²æ­¢è¯¯å·®çš„å­˜åœ¨å§(æˆ‘çŒœçš„)ã€‚

### Volleyç¼“å­˜å‘½ä¸­ç‡çš„ä¼˜åŒ–

å¦‚æœè®©ä½ å»è®¾è®¡Volleyçš„ç¼“å­˜åŠŸèƒ½ï¼Œä½ è¦å¦‚ä½•å¢å¤§å®ƒçš„å‘½ä¸­ç‡ã€‚
å¯æƒœäº†ï¼Œå¦‚æœä¸Šé¢çš„ç¼“å­˜åŠŸèƒ½æ˜¯æ˜¨å¤©çœ‹çš„ï¼Œä»Šå¤©çš„é¢è¯•è¿™ä¸ªé—®é¢˜å°±èƒ½è¯´å‡ºæ¥äº†ã€‚
è¿˜æ˜¯ä¸Šé¢çš„ä»£ç ï¼Œåœ¨ç¼“å­˜å†…å®¹å¯èƒ½è¶…è¿‡ç¼“å­˜æ–‡ä»¶å¤¹çš„å¤§å°æ—¶ï¼Œåˆ é™¤çš„é€»è¾‘æ˜¯ç›´æ¥éå†headeråˆ é™¤ã€‚è¿™ä¸ªæ—¶å€™åˆ é™¤çš„æ–‡ä»¶æœ‰å¯èƒ½æ˜¯æˆ‘ä»¬ä¸Šä¸€æ¬¡è¯·æ±‚æ—¶åˆšåˆšä¿å­˜ä¸‹æ¥çš„ï¼Œå±è‚¡éƒ½è¿˜æ²¡åç¨³å‘¢ï¼Œç°åœ¨ç«‹å³åˆ æ‰ï¼Œæœ‰ç‚¹èˆä¸å¾—å•Šã€‚
å¦‚æœéå†çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸€ä¸‹ï¼Œé¦–å…ˆåˆ é™¤è¶…è¿‡ç¼“å­˜æœ‰æ•ˆæœŸçš„(è¿‡æœŸç¼“å­˜)ï¼Œå…¶æ¬¡æŒ‰ç…§LRUç®—æ³•ï¼Œåˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„ï¼Œå²‚ä¸æ˜¯æ›´åˆé€‚ï¼Ÿ

### Volleyç¼“å­˜æ–‡ä»¶åçš„è®¡ç®—

è¿™ä¸ªæ˜¯æˆ‘ä¸€ç›´æ²¡å¼„æ‡‚çš„é—®é¢˜ã€‚
å¦‚ä¸‹ä»£ç ï¼š

```
private String getFilenameForKey(String key) {
    int firstHalfLength = key.length() / 2;
    String localFilename = String.valueOf(key.substring(0, firstHalfLength).hashCode());
    localFilename += String.valueOf(key.substring(firstHalfLength).hashCode());
    return localFilename;
}
```

ä¸ºä»€ä¹ˆä¼šè¦æŠŠä¸€ä¸ªkeyåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ±‚hashCodeï¼Œæœ€ååˆåšæ‹¼æ¥ã€‚
è¿™ä¸ªé—®é¢˜ä¹‹å‰åœ¨stackoverflowä¸Šé—®è¿‡ [#é“¾æ¥](http://stackoverflow.com/questions/34984302/why-volley-diskbasedcache-splicing-without-direct-access-to-the-cache-file-name/34987423#34987423) 
åŸè°…æˆ‘ï¼Œåˆ«äººçš„å›ç­”æˆ‘æœ€åˆå¹¶æ²¡æœ‰çœ‹æ‡‚ã€‚ç›´åˆ°æœ€è¿‘è¢«é—®åˆ°ï¼Œå¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªHashMapï¼Œå¦‚ä½•é¿å…valueè¢«è¦†ç›–ï¼Œæˆ‘æ‰æƒ³åˆ°åŸå› ã€‚
å…ˆæ¥çœ‹ä¸€ä¸‹ `String#hashCode()` çš„å®ç°ï¼š

```
@Override public int hashCode() {
    int hash = hashCode;
    if (hash == 0) {
        if (count == 0) {
            return 0;
        }
        final int end = count + offset;
        final char[] chars = value;
        for (int i = offset; i < end; ++i) {
            hash = 31*hash + chars[i];
        }
        hashCode = hash;
    }
    return hash;
}
```

ä»ä¸Šé¢çš„å®ç°å¯ä»¥çœ‹åˆ°ï¼ŒStringçš„hashcodeæ˜¯æ ¹æ®å­—ç¬¦æ•°ç»„ä¸­æ¯ä¸ªä½ç½®çš„å­—æ¯çš„intå€¼å†åŠ ä¸Šä¸Šæ¬¡hashå€¼ä¹˜ä»¥31ï¼Œè¿™ç§ç®—æ³•æ±‚å‡ºæ¥çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯31ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šã€‚
ä½†æ˜¯å¯ä»¥è‚¯å®šä¸€ç‚¹ï¼Œhashcodeå¹¶ä¸æ˜¯å”¯ä¸€çš„ã€‚ä¸ä¿¡ä½ è¿è¡Œä¸‹é¢è¿™ä¸¤ä¸ªè¾“å‡ºï¼š

```
System.out.print("======" + "vFrKiaNHfF7t[9::E[XsX?L7xPp3DZSteIZvdRT8CX:w6d;v<_KZnhsM_^dqoppe".hashCode());
System.out.print("======" + "hI4pFxGOfS@suhVUd:mTo_begImJPB@Fl[6WJ?ai=RXfIx^=Aix@9M;;?Vdj_Zsi".hashCode());
```

è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯æ ¹æ®hashcodeçš„ç®—æ³•é€†å‘å‡ºæ¥çš„ï¼Œä»–ä»¬çš„hashcodeéƒ½æ˜¯12345ã€‚é€†å‘ç®—æ³•è¯·è§[è¿™é‡Œ](http://my.oschina.net/backtract/blog/169310)
å†å›åˆ°æˆ‘ä»¬çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¼šè¦æŠŠä¸€ä¸ªkeyåˆ†æˆä¸¤éƒ¨åˆ†ã€‚ç°åœ¨å¯ä»¥è‚¯å®šçš„ç­”å‡ºï¼Œç›®çš„æ˜¯ä¸ºäº†å°½å¯èƒ½é¿å…hashcodeé‡å¤é€ æˆçš„æ–‡ä»¶åé‡å¤(æ±‚ä¸¤æ¬¡hashä¸¤æ¬¡éƒ½ä¸å¦ä¸€ä¸ªurlé‡å¤çš„æ¦‚ç‡æ€»è¦æ¯”ä¸€æ¬¡é‡å¤çš„æ¦‚ç‡å°å§)ã€‚
é¡ºå¸¦å†æä¸€ç‚¹ï¼Œå°±åƒä¸Šé¢è¯´çš„ï¼Œæ¦‚ç‡å°å¹¶ä¸ä»£è¡¨ä¸å­˜åœ¨ã€‚ä½†æ˜¯Javaè®¡ç®—hashcodeçš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œåº”è¯¥æ˜¯åœ¨æ•ˆç‡å’Œå®‰å…¨æ€§ä¸Šå–èˆçš„ç»“æœå§ã€‚

# Glideæºç è§£æ

å‚è€ƒï¼š[http://www.lightskystreet.com/2015/10/12/glide_source_analysis/](http://www.lightskystreet.com/2015/10/12/glide_source_analysis/)
[http://frodoking.github.io/2015/10/10/android-glide/](http://frodoking.github.io/2015/10/10/android-glide/)











